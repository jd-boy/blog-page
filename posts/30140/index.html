<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="JD">
    
    <title>
        
            不可变基础设施【虚拟化容器】 |
        
        Bean You
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"jzcupid.cn","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico","favicon":"http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"何妨吟啸且徐行"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"trigger":"auto","preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Bean You
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">不可变基础设施【虚拟化容器】</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">JD</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2022-05-22 13:29:20
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%87%A4%E5%87%B0%E6%9E%B6%E6%9E%84/">凤凰架构</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>容器是云计算、微服务等诸多软件业界核心技术的共同基石，容器的首要目标是让软件分发部署过程从传统的发布安装包、靠人工部署转变为直接发布已经部署好的、包含整套运行环境的虚拟化镜像。在容器技术成熟之前，主流的软件部署过程是由系统管理员编译或下载好二进制安装包，根据软件的部署说明文档准备好正确的操作系统、第三方库、配置文件、资源权限等各种前置依赖以后，才能将程序正确地运行起来。<a class="link"   target="_blank" rel="noopener" href="http://chadfowler.com/" >Chad Fowler<i class="fas fa-external-link-alt"></i></a>在提出“不可变基础设施”这个概念的文章《<a class="link"   target="_blank" rel="noopener" href="http://chadfowler.com/2013/06/23/immutable-deployments.html" >Trash Your Servers and Burn Your Code<i class="fas fa-external-link-alt"></i></a>》里，开篇就直接吐槽：要把一个不知道打过多少个升级补丁，不知道经历了多少任管理员的系统迁移到其他机器上，毫无疑问会是一场灾难。</p>
<p>让软件能够在任何环境、任何物理机器上达到“一次编译，到处运行”曾是 Java 早年的宣传口号，这并不是一个简单的目标，不设前提的“到处运行”，仅靠 Java 语言和 Java 虚拟机是不可能达成的，因为一个计算机软件要能够正确运行，需要有以下三方面的兼容性来共同保障（这里仅讨论软件兼容性，不去涉及“如果没有摄像头就无法运行照相程序”这类问题）：</p>
<ul>
<li><strong>ISA 兼容</strong>：目标机器指令集兼容性，譬如 ARM 架构的计算机无法直接运行面向 x86 架构编译的程序。</li>
<li><strong>ABI 兼容</strong>：目标系统或者依赖库的二进制兼容性，譬如 Windows 系统环境中无法直接运行 Linux 的程序，又譬如 DirectX 12 的游戏无法运行在 DirectX 9 之上。</li>
<li><strong>环境兼容</strong>：目标环境的兼容性，譬如没有正确设置的配置文件、环境变量、注册中心、数据库地址、文件系统的权限等等，任何一个环境因素出现错误，都会让你的程序无法正常运行。</li>
</ul>
<p>额外知识：ISA 与 ABI</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Instruction_set_architecture" >指令集架构<i class="fas fa-external-link-alt"></i></a>（Instruction Set Architecture，ISA）是计算机体系结构中与程序设计有关的部分，包含了基本数据类型，指令集，寄存器，寻址模式，存储体系，中断，异常处理以及外部 I/O。指令集架构包含一系列的 Opcode 操作码（即通常所说的机器语言），以及由特定处理器执行的基本命令。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Application_binary_interface" >应用二进制接口<i class="fas fa-external-link-alt"></i></a>（Application Binary Interface，ABI）是应用程序与操作系统之间或其他依赖库之间的低级接口。ABI 涵盖了各种底层细节，如数据类型的宽度大小、对象的布局、接口调用约定等等。ABI 不同于<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/API" >应用程序接口<i class="fas fa-external-link-alt"></i></a>（Application Programming Interface，API），API 定义的是源代码和库之间的接口，因此同样的代码可以在支持这个 API 的任何系统中编译，而 ABI 允许编译好的目标代码在使用兼容 ABI 的系统中无需改动就能直接运行。</p>
<p>笔者把使用仿真（Emulation）以及虚拟化（Virtualization）技术来解决以上三项兼容性问题的方法都统称为虚拟化技术。根据抽象目标与兼容性高低的不同，虚拟化技术又分为下列五类：</p>
<ul>
<li><strong>指令集虚拟化</strong>（ISA Level Virtualization）。通过软件来模拟不同 ISA 架构的处理器工作过程，将虚拟机发出的指令转换为符合本机 ISA 的指令，代表为<a class="link"   target="_blank" rel="noopener" href="https://www.qemu.org/" >QEMU<i class="fas fa-external-link-alt"></i></a>和<a class="link"   target="_blank" rel="noopener" href="http://bochs.sourceforge.net/" >Bochs<i class="fas fa-external-link-alt"></i></a>。指令集虚拟化就是仿真，能提供了几乎完全不受局限的兼容性，甚至能做到直接在 Web 浏览器上运行完整操作系统这种令人惊讶的效果，但由于每条指令都要由软件来转换和模拟，它也是性能损失最大的虚拟化技术。</li>
<li><strong>硬件抽象层虚拟化</strong>（Hardware Abstraction Level Virtualization）。以软件或者直接通过硬件来模拟处理器、芯片组、内存、磁盘控制器、显卡等设备的工作过程。既可以使用纯软件的二进制翻译来模拟虚拟设备，也可以由硬件的<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X86_virtualization#Intel-VT-d" >Intel VT-d<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X86_virtualization#AMD_virtualization_(AMD-V)" >AMD-Vi<i class="fas fa-external-link-alt"></i></a>这类虚拟化技术，将某个物理设备直通（Passthrough）到虚拟机中使用，代表为<a class="link"   target="_blank" rel="noopener" href="https://www.vmware.com/" >VMware ESXi<i class="fas fa-external-link-alt"></i></a>和<a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/" >Hyper-V<i class="fas fa-external-link-alt"></i></a>。如果没有预设语境，一般人们所说的“虚拟机”就是指这一类虚拟化技术。</li>
<li><strong>操作系统层虚拟化</strong>（OS Level Virtualization）。无论是指令集虚拟化还是硬件抽象层虚拟化，都会运行一套完全真实的操作系统来解决 ABI 兼容性和环境兼容性问题，虽然 ISA 兼容性是虚拟出来的，但 ABI 兼容性和环境兼容性却是真实存在的。而操作系统层虚拟化则不会提供真实的操作系统，而是采用隔离手段，使得不同进程拥有独立的系统资源和资源配额，看起来仿佛是独享了整个操作系统一般，其实系统的内核仍然是被不同进程所共享的。<br>操作系统层虚拟化的另一个名字就是本章的主角“容器化”（Containerization），由此可见，容器化仅仅是虚拟化的一个子集，只能提供操作系统内核以上的部分 ABI 兼容性与完整的环境兼容性。这意味着如果没有其他虚拟化手段的辅助，在 Windows 系统上是不可能运行 Linux 的 Docker 镜像的（现在可以，是因为有其他虚拟机或者 WSL2 的支持），反之亦然。也同样决定了如果 Docker 宿主机的内核版本是 Linux Kernel 5.6，那无论上面运行的镜像是 Ubuntu、RHEL、Fedora、Mint 或者任何发行版的镜像，看到的内核一定都是相同的 Linux Kernel 5.6。容器化牺牲了一定的隔离性与兼容性，换来的是比前两种虚拟化更高的启动速度、运行性能和更低的执行负担。</li>
<li><strong>运行库虚拟化</strong>（Library Level Virtualization）。与操作系统虚拟化采用隔离手段来模拟系统不同，运行库虚拟化选择使用软件翻译的方法来模拟系统，它以一个独立进程来代替操作系统内核来提供目标软件运行所需的全部能力，这种虚拟化方法获得的 ABI 兼容性高低，取决于软件是否能足够准确和全面地完成翻译工作，其代表为<a class="link"   target="_blank" rel="noopener" href="https://www.winehq.org/" >WINE<i class="fas fa-external-link-alt"></i></a>（Wine Is Not an Emulator 的缩写，一款在 Linux 下运行 Windows 程序的软件）和<a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/about" >WSL<i class="fas fa-external-link-alt"></i></a>（特指 Windows Subsystem for Linux Version 1）。</li>
<li><strong>语言层虚拟化</strong>（Programming Language Level Virtualization）。由虚拟机将高级语言生成的中间代码转换为目标机器可以直接执行的指令，代表为 Java 的 JVM 和.NET 的 CLR。虽然厂商肯定会提供不同系统下都有相同接口的标准库，但本质上这种虚拟化并不直接解决任何 ABI 兼容性和环境兼容性问题。</li>
</ul>
<h1 id="一、容器的崛起"><a href="#一、容器的崛起" class="headerlink" title="一、容器的崛起"></a>一、容器的崛起</h1><p>容器的最初的目的不是为了部署软件，而是为了隔离计算机中的各类资源，以便降低软件开发、测试阶段可能产生的误操作风险，或者专门充当<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Honeypot_(computing)" >蜜罐<i class="fas fa-external-link-alt"></i></a>，吸引黑客的攻击，以便监视黑客的行为。下面，笔者将以容器发展历史为线索，介绍容器技术在不同历史阶段中的主要关注点。</p>
<h3 id="隔离文件：chroot"><a href="#隔离文件：chroot" class="headerlink" title="隔离文件：chroot"></a>隔离文件：chroot</h3><p>容器的起点可以追溯到 1979 年<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Version_7_Unix" >Version 7 UNIX<i class="fas fa-external-link-alt"></i></a>系统中提供的<code>chroot</code>命令，这个命令是英文单词“Change Root”的缩写，功能是当某个进程经过<code>chroot</code>操作之后，它的根目录就会被锁定在命令参数所指定的位置，以后它或者它的子进程将不能再访问和操作该目录之外的其他文件。</p>
<p>1991 年，世界上第一个监控黑客行动的蜜罐程序就是使用<code>chroot</code>来实现的，那个参数指定的根目录当时被作者戏称为“Chroot 监狱”（Chroot Jail），黑客突破<code>chroot</code>限制的方法就称为 Jailbreak。后来，FreeBSD 4.0 系统重新实现了<code>chroot</code>命令，用它作为系统中进程沙箱隔离的基础，并将其命名为<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/FreeBSD_jail" >FreeBSD jail<i class="fas fa-external-link-alt"></i></a>，再后来，苹果公司又以 FreeBSD 为基础研发出了举世闻名的 iOS 操作系统，此时，黑客们就将绕过 iOS 沙箱机制以 root 权限任意安装程序的方法称为“<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IOS_jailbreaking" >越狱<i class="fas fa-external-link-alt"></i></a>”（Jailbreak），这些故事都是题外话了。</p>
<p>2000 年，Linux Kernel 2.3.41 版内核引入了<code>pivot_root</code>技术来实现文件隔离，<code>pivot_root</code>直接切换了<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" >根文件系统<i class="fas fa-external-link-alt"></i></a>（rootfs），有效地避免了<code>chroot</code>命令可能出现的安全性漏洞。本文后续提到的容器技术，如 LXC、Docker 等也都是优先使用<code>pivot_root</code>来实现根文件系统切换的。</p>
<p>时至今日，<code>chroot</code>命令依然活跃在 UNIX 系统与几乎所有主流的 Linux 发行版中，同时以命令行工具（<a class="link"   target="_blank" rel="noopener" href="https://linux.die.net/man/8/linux-user-chroot" >chroot(8)<i class="fas fa-external-link-alt"></i></a>）或者系统调用（<a class="link"   target="_blank" rel="noopener" href="https://linux.die.net/man/2/chroot" >chroot(2)<i class="fas fa-external-link-alt"></i></a>）的形式存在，但无论是<code>chroot</code>命令抑或是<code>pivot_root</code>，都并不能提供完美的隔离性。原本按照 UNIX 的设计哲学，<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Everything_is_a_file" >一切资源都可以视为文件<i class="fas fa-external-link-alt"></i></a>（In UNIX，Everything is a File），一切处理都可以视为对文件的操作，理论上，只要隔离了文件系统，一切资源都应该被自动隔离才对。可是哲学归哲学，现实归现实，从硬件层面暴露的低层次资源，如磁盘、网络、内存、处理器，到经操作系统层面封装的高层次资源，如 UNIX 分时（UNIX Time-Sharing，UTS）、进程 ID（Process ID，PID）、用户 ID（User ID，UID）、进程间通信（Inter-Process Communication，IPC）都存在大量以非文件形式暴露的操作入口，因此，以<code>chroot</code>为代表的文件隔离，仅仅是容器崛起之路的起点而已。</p>
<h3 id="隔离访问：namespaces"><a href="#隔离访问：namespaces" class="headerlink" title="隔离访问：namespaces"></a>隔离访问：namespaces</h3><p>2002 年，Linux Kernel 2.4.19 版内核引入了一种全新的隔离机制：<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Linux_namespaces" >Linux 名称空间<i class="fas fa-external-link-alt"></i></a>（Linux Namespaces）。名称空间的概念在很多现代的高级程序语言中都存在，用于避免不同开发者提供的 API 相互冲突，相信作为一名开发人员的你肯定不陌生。</p>
<p>Linux 的名称空间是一种由内核直接提供的全局资源封装，是内核针对进程设计的访问隔离机制。进程在一个独立的 Linux 名称空间中朝系统看去，会觉得自己仿佛就是这方天地的主人，拥有这台 Linux 主机上的一切资源，不仅文件系统是独立的，还有着独立的 PID 编号（譬如拥有自己的 0 号进程，即系统初始化的进程）、UID/GID 编号（譬如拥有自己独立的 root 用户）、网络（譬如完全独立的 IP 地址、网络栈、防火墙等设置），等等，此时进程的心情简直不能再好了。</p>
<p>Linux 的名称空间是受“<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs" >贝尔实验室九号项目<i class="fas fa-external-link-alt"></i></a>”（一个分布式操作系统，“九号”项目并非代号，操作系统的名字就叫“Plan 9 from Bell Labs”，充满了赛博朋克风格）的启发而设计的，最初的目的依然只是为了隔离文件系统，而非为了什么容器化的实现。这点从 2002 年发布时只提供了 Mount 名称空间，并且其构造参数为“CLONE_NEWNS”（即 Clone New Namespace 的缩写）而非“CLONE_NEWMOUNT”便能看出一些端倪。后来，要求系统隔离其他访问操作的呼声愈发强烈，从 2006 年起，内核陆续添加了 UTS、IPC 等名称空间隔离，直到目前最新的 Linux Kernel 5.6 版内核为止，Linux 名称空间支持以下八种资源的隔离（内核的官网<a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/" >Kernel.org<i class="fas fa-external-link-alt"></i></a>上仍然只列出了<a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/admin-guide/namespaces/compatibility-list.html" >前六种<i class="fas fa-external-link-alt"></i></a>，从 Linux 的 Man 命令能查到<a class="link"   target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man7/namespaces.7.html" >全部八种<i class="fas fa-external-link-alt"></i></a>）。</p>
<p>表 11-1 Linux 名称空间支持以下八种资源的隔离</p>
<table>
<thead>
<tr>
<th align="left">名称空间</th>
<th>隔离内容</th>
<th>内核版本</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Mount</td>
<td>隔离文件系统，功能上大致可以类比<code>chroot</code></td>
<td>2.4.19</td>
</tr>
<tr>
<td align="left">UTS</td>
<td>隔离主机的<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hostname" >Hostname<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Domain_name" >Domain names<i class="fas fa-external-link-alt"></i></a></td>
<td>2.6.19</td>
</tr>
<tr>
<td align="left">IPC</td>
<td>隔离进程间通信的渠道（详见“<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/architect-perspective/general-architecture/api-style/rpc.html" >远程服务调用<i class="fas fa-external-link-alt"></i></a>”中对 IPC 的介绍）</td>
<td>2.6.19</td>
</tr>
<tr>
<td align="left">PID</td>
<td>隔离进程编号，无法看到其他名称空间中的 PID，意味着无法对其他进程产生影响</td>
<td>2.6.24</td>
</tr>
<tr>
<td align="left">Network</td>
<td>隔离网络资源，如网卡、网络栈、IP 地址、端口，等等</td>
<td>2.6.29</td>
</tr>
<tr>
<td align="left">User</td>
<td>隔离用户和用户组</td>
<td>3.8</td>
</tr>
<tr>
<td align="left">Cgroup</td>
<td>隔离<code>cgroups</code>信息，进程有自己的<code>cgroups</code>的根目录视图（在/proc/self/cgroup 不会看到整个系统的信息）。<code>cgroups</code>的话题很重要，稍后笔者会安排一整节来介绍</td>
<td>4.6</td>
</tr>
<tr>
<td align="left">Time</td>
<td>隔离系统时间，2020 年 3 月最新的 5.6 内核开始支持进程独立设置系统时间</td>
<td>5.6</td>
</tr>
</tbody></table>
<p>如今，对文件、进程、用户、网络等各类信息的访问，都被囊括在 Linux 的名称空间中，即使今天仍有一些没被隔离的访问（譬如<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Syslog" >syslog<i class="fas fa-external-link-alt"></i></a>就还没被隔离，容器内可以看到容器外其他进程产生的内核 syslog），日后也可以随内核版本的更新纳入到这套框架之内，现在距离完美的隔离性就只差最后一步了：资源的隔离。</p>
<h3 id="隔离资源：cgroups"><a href="#隔离资源：cgroups" class="headerlink" title="隔离资源：cgroups"></a>隔离资源：cgroups</h3><p>如果要让一台物理计算机中的各个进程看起来像独享整台虚拟计算机的话，不仅要隔离各自进程的访问操作，还必须能独立控制分配给各个进程的资源使用配额，不然的话，一个进程发生了内存溢出或者占满了处理器，其他进程就莫名其妙地被牵连挂起，这样肯定算不上是完美的隔离。</p>
<p>Linux 系统解决以上问题的方案是<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cgroups" >控制群组<i class="fas fa-external-link-alt"></i></a>（Control Groups，目前常用的简写为<code>cgroups</code>），它与名称空间一样都是直接由内核提供的功能，用于隔离或者说分配并限制某个进程组能够使用的资源配额，资源配额包括处理器时间、内存大小、磁盘 I/O 速度，等等，具体可以参见表 11-2 所示。</p>
<p>表 11-2 Linux 控制群组子系统</p>
<table>
<thead>
<tr>
<th>控制组子系统</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>blkio</td>
<td>为块设备（如磁盘，固态硬盘，USB 等等）设定 I/O 限额。</td>
</tr>
<tr>
<td>cpu</td>
<td>控制<code>cgroups</code>中进程的处理器占用比率。</td>
</tr>
<tr>
<td>cpuacct</td>
<td>自动生成<code>cgroups</code>中进程所使用的处理器时间的报告。</td>
</tr>
<tr>
<td>cpuset</td>
<td>为<code>cgroups</code>中的进程分配独立的处理器（包括多路系统的处理器，多核系统的处理器核心）。</td>
</tr>
<tr>
<td>devices</td>
<td>设置<code>cgroups</code>中的进程访问某个设备的权限（读、写、创建三种权限）。</td>
</tr>
<tr>
<td>freezer</td>
<td>挂起或者恢复<code>cgroups</code>中的进程。</td>
</tr>
<tr>
<td>memory</td>
<td>设定<code>cgroups</code>中进程使用内存的限制，并自动生成内存资源使用报告。</td>
</tr>
<tr>
<td>net_cls</td>
<td>使用等级识别符标记网络数据包，可允许 Linux 流量控制程序识别从具体 <code>cgroups</code>中生成的数据包。</td>
</tr>
<tr>
<td>net_prio</td>
<td>用来设置网络流量的优先级。</td>
</tr>
<tr>
<td>hugetlb</td>
<td>主要针对于 HugeTLB 系统进行限制。</td>
</tr>
<tr>
<td>perf_event</td>
<td>允许 Perf 工具基于<code>cgroups</code>分组做性能监测。</td>
</tr>
</tbody></table>
<p><code>cgroups</code>项目最早是由 Google 的工程师（主要是 Paul Menage 和 Rohit Seth）在 2006 年发起的，当时取的名字就叫作“进程容器”（Process Containers），不过“容器”（Container）这个名词的定义在那时候尚不如今天清晰，不同场景中常有不同所指，为避免混乱，2007 年这个项目才被重命名为<code>cgroups</code>，在 2008 年合并到 2.6.24 版的内核后正式对外发布，这一阶段的<code>cgroups</code>被称为“第一代<code>cgroups</code>”。2016 年 3 月发布的 Linux Kernel 4.5 中，搭载了由 Facebook 工程师（主要是 Tejun Heo）重新编写的“第二代<code>cgroups</code>”，其关键改进是支持统一层级管理（<a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/cgroup-v2.txt" >Unified Hierarchy<i class="fas fa-external-link-alt"></i></a>），使得管理员能更加清晰精确地控制资源的层级关系。目前这两个版本的<code>cgroups</code>在 Linux 内核代码中是并存的，稍后介绍的 Docker 暂时仅支持第一代的<code>cgroups</code>。</p>
<h3 id="封装系统：LXC"><a href="#封装系统：LXC" class="headerlink" title="封装系统：LXC"></a>封装系统：LXC</h3><p>当文件系统、访问、资源都可以被隔离后，容器已经有它降生所需的全部前置支撑条件，并且 Linux 的开发者们也已经明确地看到了这一点。为降低普通用户综合使用<code>namespaces</code>、<code>cgroups</code>这些低级特性的门槛，2008 年 Linux Kernel 2.6.24 内核刚刚开始提供<code>cgroups</code>的同一时间，就马上发布了名为<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/LXC" >Linux 容器<i class="fas fa-external-link-alt"></i></a>（LinuX Containers，LXC）的系统级虚拟化功能。</p>
<p>此前，在 Linux 上并不是没有系统级虚拟化的解决方案，譬如传统的<a class="link"   target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/OpenVZ" >OpenVZ<i class="fas fa-external-link-alt"></i></a>和<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Linux-VServer" >Linux-VServer<i class="fas fa-external-link-alt"></i></a>都能够实现容器隔离，并且只会有很低的性能损失（按 OpenVZ 提供的数据，只会有 1-3%的损失），但它们都是非官方的技术，使用它们最大的阻碍是系统级虚拟化必须要有内核的支持，为此它们就只能通过非官方内核补丁的方式修改标准内核，才能获得那些原本在内核中不存在的能力。</p>
<p>LXC 带着令人瞩目的光环登场，它的出现促使“容器”从一个阳春白雪的只流传于开发人员口中的技术词汇，逐渐向整个软件业的公共概念、共同语言发展，就如同今天的“服务器”、“客户端”和“互联网”一样。相信你现在肯定会好奇为什么现在一提到容器，大家首先联想到的是 Docker 而不是 LXC？为什么去问 10 个开发人员，至少有 9 个听过 Docker，但如果问 LXC，可能只有 1 个人会听说过？</p>
<p>LXC 的出现肯定受到了 OpenVZ 和 Linux-VServer 的启发，摸着巨人的肩膀过河这并没有什么不对。可惜的是，LXC 在设定自己的发展目标时，也被前辈们的影响所局限住。LXC 眼中的容器的定义与 OpenVZ 和 Linux-VServer 并无差别，是一种封装系统的轻量级虚拟机，而 Docker 眼中的容器的定义则是一种封装应用的技术手段。这两种封装理念在技术层面并没有什么本质区别，但应用效果就差异巨大。举个具体例子，如果你要建设一个<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/LAMP_(software_bundle)" >LAMP<i class="fas fa-external-link-alt"></i></a>（Linux、Apache、MySQL、PHP）应用，按照 LXC 的思路，你应该先编写或者寻找到<a class="link"   target="_blank" rel="noopener" href="https://gist.github.com/ralt/492a09d9f9fea64fb28b" >LAMP 的 template<i class="fas fa-external-link-alt"></i></a>（可以暂且不准确地类比为 LXC 版本的 Dockerfile 吧），以此构造出一个安装了 LAMP 的虚拟系统。如果按部署虚拟机的角度来看，这还算挺方便的，作为那个时代（距今也就十年）的系统管理员，所有软件、补丁、配置都是自己搞定的，部署一台新虚拟机要花费一两天时间都很正常，有 LXC 的 template，一下子帮你把 LAMP 都安装好了，还想要啥自行车？但是，作为一名现代的系统管理员，这里问题就相当大，如果我想把 LAMP 改为 LNMP（Linux、Nginx、MySQL、PHP）该怎么办？如果我想把 LAMP 里的 MySQL 5 调整为 MySQL 8 该怎么办？都得找到或者自己编写新的 template 来解决。好吧，那这台机的软件、版本都配置对了，下一台机我要构建<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/LYME_(software_bundle)" >LYME<i class="fas fa-external-link-alt"></i></a>或者<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/MEAN_(solution_stack)" >MEAN<i class="fas fa-external-link-alt"></i></a>，又该怎么办？以封装系统为出发点，仍是按照先装系统然再装软件的思路，就永远无法做到一两分钟甚至十几秒钟就构造出一个合乎要求的软件运行环境，也决定了 LXC 不可能形成今天的容器生态的，所以，接下来舞台的聚光灯终于落到了 Docker 身上。</p>
<h3 id="封装应用：Docker"><a href="#封装应用：Docker" class="headerlink" title="封装应用：Docker"></a>封装应用：Docker</h3><p>2013 年宣布开源的 Docker 毫无疑问是容器发展历史上里程碑式的发明，然而 Docker 的成功似乎没有太多技术驱动的成分。至少对开源早期的 Docker 而言，确实没有什么能构成壁垒的技术。它的容器化能力直接来源于 LXC，它镜像分层组合的文件系统直接来源于<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Aufs" >AUFS<i class="fas fa-external-link-alt"></i></a>，Docker 开源后不久，就有人仅用了一百多行 Shell 脚本便实现了 Docker 的核心功能（名为<a class="link"   target="_blank" rel="noopener" href="https://github.com/p8952/bocker" >Bocker<i class="fas fa-external-link-alt"></i></a>，提供了<code>docker build/pull/images/ps/run/exec/logs/commit/rm/rmi</code>等功能）。</p>
<p>那为何历史选择了 Docker，而不是 LXC 或者其他容器技术呢？对于这个问题，笔者引用（转述非直译，有所精简）DotCloud 公司（当年创造 Docker 的公司，已于 2016 年倒闭）创始人 Solomon Hykes 在<a class="link"   target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools/" >Stackoverflow 上的一段问答<i class="fas fa-external-link-alt"></i></a>：</p>
<p>为什么要用 Docker 而不是 LXC？（Why would I use Docker over plain LXC？）</p>
<p>Docker 除了包装来自 Linux 内核的特性之外，它的价值还在于：</p>
<ul>
<li><strong>跨机器的绿色部署</strong>：Docker 定义了一种将应用及其所有的环境依赖都打包到一起的格式，仿佛它原本就是<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Portable_application" >绿色软件<i class="fas fa-external-link-alt"></i></a>一样。LXC 并没有提供这样的能力，使用 LXC 部署的新机器很多细节都依赖人的介入，虚拟机的环境几乎肯定会跟你原本部署程序的机器有所差别。</li>
<li><strong>以应用为中心的封装</strong>：Docker 封装应用而非封装机器的理念贯穿了它的设计、API、界面、文档等多个方面。相比之下，LXC 将容器视为对系统的封装，这局限了容器的发展。</li>
<li><strong>自动构建</strong>：Docker 提供了开发人员从在容器中构建产品的全部支持，开发人员无需关注目标机器的具体配置，即可使用任意的构建工具链，在容器中自动构建出最终产品。</li>
<li><strong>多版本支持</strong>：Docker 支持像 Git 一样管理容器的连续版本，进行检查版本间差异、提交或者回滚等操作。从历史记录中你可以查看到该容器是如何一步一步构建成的，并且只增量上传或下载新版本中变更的部分。</li>
<li><strong>组件重用</strong>：Docker 允许将任何现有容器作为基础镜像来使用，以此构建出更加专业的镜像。</li>
<li><strong>共享</strong>：Docker 拥有公共的镜像仓库，成千上万的 Docker 用户在上面上传了自己的镜像，同时也使用他人上传的镜像。</li>
<li><strong>工具生态</strong>：Docker 开放了一套可自动化和自行扩展的接口，在此之上，还有很多工具来扩展其功能，譬如容器编排、管理界面、持续集成等等。</li>
</ul>
<p>—— Solomon Hykes，<a class="link"   target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools/" >Stackoverflow<i class="fas fa-external-link-alt"></i></a>，2013</p>
<p>以上这段回答也同时被收录到了<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/engine/faq/" >Docker 官网的 FAQ<i class="fas fa-external-link-alt"></i></a>上，从 Docker 开源至今从未改变。促使 Docker 的一问世就惊艳世间的，不是什么黑科技式的秘密武器，而是其符合历史潮流的创意与设计理念，还有充分开放的生态运营。可见，在正确的时候，正确的人手上有一个优秀的点子，确实有机会引爆一个时代。</p>
<p><img src="http://qiniu.jzcupid.cn/blog/docker.cdd74fc8.jpg" alt="受到广泛认可的 Docker"><br>以上是 Docker 开源一年后（截至 2014 年 12 月）获得的成绩，图片来自<a class="link"   target="_blank" rel="noopener" href="https://www.docker.com/company/aboutus/" >Docker 官网<i class="fas fa-external-link-alt"></i></a></p>
<p>从开源到现在也只过了短短数年时间，Docker 已成为软件开发、测试、分发、部署等各个环节都难以或缺的基础支撑，自身的架构也发生了相当大的改变，Docker 被分解为由 Docker Client、Docker Daemon、Docker Registry、Docker Container 等子系统，以及 Graph、Driver、libcontainer 等各司其职的模块组成，此时再说一百多行脚本能实现 Docker 核心功能，再说 Docker 没有太高的技术含量，就已经不再合适了。</p>
<p>2014 年，Docker 开源了自己用 Golang 开发的<a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/runc/tree/master/libcontainer" >libcontainer<i class="fas fa-external-link-alt"></i></a>，这是一个越过 LXC 直接操作<code>namespaces</code>和<code>cgroups</code>的核心模块，有了 libcontainer 以后，Docker 就能直接与系统内核打交道，不必依赖 LXC 来提供容器化隔离能力了。</p>
<p>2015 年，在 Docker 的主导和倡议下，多家公司联合制定了“<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Open_Container_Initiative" >开放容器交互标准<i class="fas fa-external-link-alt"></i></a>”（Open Container Initiative，OCI），这是一个关于容器格式和运行时的规范文件，其中包含运行时标准（<a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/runtime-spec/blob/master/spec.md" >runtime-spec<i class="fas fa-external-link-alt"></i></a> ）、容器镜像标准（<a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/image-spec/blob/master/spec.md" >image-spec<i class="fas fa-external-link-alt"></i></a>）和镜像分发标准（<a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/distribution-spec/blob/master/spec.md" >distribution-spec<i class="fas fa-external-link-alt"></i></a>，分发标准还未正式发布）。运行时标准定义了应该如何运行一个容器、如何管理容器的状态和生命周期、如何使用操作系统的底层特性（<code>namespaces</code>、<code>cgroup</code>、<code>pivot_root</code>等）；容器镜像标准规定了容器镜像的格式、配置、元数据的格式，可以理解为对镜像的静态描述；镜像分发标准则规定了镜像推送和拉取的网络交互过程。</p>
<p>为了符合 OCI 标准，Docker 推动自身的架构继续向前演进，首先将 libcontainer 独立出来，封装重构成<a class="link"   target="_blank" rel="noopener" href="https://github.com/opencontainers/runc" >runC 项目<i class="fas fa-external-link-alt"></i></a>，并捐献给了 Linux 基金会管理。runC 是 OCI Runtime 的首个参考实现，提出了“让标准容器无所不在”（Make Standard Containers Available Everywhere）的口号。为了能够兼容所有符合标准的 OCI Runtime 实现，Docker 进一步重构了 Docker Daemon 子系统，将其中与运行时交互的部分抽象为<a class="link"   target="_blank" rel="noopener" href="https://containerd.io/" >containerd 项目<i class="fas fa-external-link-alt"></i></a>，这是一个负责管理容器执行、分发、监控、网络、构建、日志等功能的核心模块，内部会为每个容器运行时创建一个 containerd-shim 适配进程，默认与 runC 搭配工作，但也可以切换到其他 OCI Runtime 实现上（然而实际并没做到，最后 containerd 仍是紧密绑定于 runC）。2016 年，Docker 把 containerd 捐献给了 CNCF 管理，runC 与 containerd 两个项目的捐赠托管，即带有 Docker 对开源信念的追求，也带有 Docker 在众多云计算大厂夹击下自救的无奈，这两个项目将成为未来 Docker 消亡和存续的伏笔（看到本节末尾你就能理解这句矛盾的话了）。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnQAAAH0CAMAAACD70C4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5Mjc2MDBGRkY1NkExMUVBOTAzQ0Q0QkMxQjk4RENGNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5Mjc2MDEwMEY1NkExMUVBOTAzQ0Q0QkMxQjk4RENGNyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjkyNzYwMEZERjU2QTExRUE5MDNDRDRCQzFCOThEQ0Y3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjkyNzYwMEZFRjU2QTExRUE5MDNDRDRCQzFCOThEQ0Y3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+nlEDIwAAAT5QTFRFuLi4AAAAmZmZ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" alt="Docker、containerd 和 runC 的交互关系"></p>
<p>以上笔者列举的这些 Docker 推动的开源与标准化工作，既是对 Docker 为开源乃至整个软件业做出贡献的赞赏，也是为后面介绍容器编排时，讲述当前容器引擎的混乱关系做的前置铺垫。Docker 目前无疑在容器领域具有统治地位，但统治的稳固程度不仅没到高枕无忧，说是危机四伏都不为过。目前已经有了可见的、足以威胁动摇 Docker 地位的潜在可能性正在酝酿，风险源于虽然 Docker 赢得了容器战争，但 Docker Swarm 却输掉了容器编排战争。从结果回望当初，Docker 赢得容器战争有一些偶然，Docker Swarm 输掉的编排战争却是必然的。</p>
<h2 id="封装集群：Kubernetes"><a href="#封装集群：Kubernetes" class="headerlink" title="封装集群：Kubernetes"></a>封装集群：Kubernetes</h2><p>如果说以 Docker 为代表的容器引擎将软件的发布流程从分发二进制安装包转变为直接分发虚拟化后的整个运行环境，令应用得以实现跨机器的绿色部署；那以 Kubernetes 为代表的容器编排框架，就是把大型软件系统运行所依赖的集群环境也进行了虚拟化，令集群得以实现跨数据中心的绿色部署，并能够根据实际情况自动扩缩。</p>
<p>容器的崛起之路讲到 Docker 和 Kubernetes 这阶段，已经不再是介绍历史了，从这里开始发生的变化，都是近几年软件业界中的热点事件，也是这章要讨论的主要话题。现在笔者暂时不打算介绍 Kubernetes 的技术细节，它们将会被留到后面的文章中更详细的解析。这节里，我们首先从宏观层面去理解 Kubernetes 的诞生与演变的驱动力，这对正确理解未来云原生的发展方向至关重要。</p>
<p>Kubernetes 可谓出身名门，前身是 Google 内部已运行多年的集群管理系统 Borg，2014 年 6 月使用 Golang 完全重写后开源。自诞生之日起，只要与云计算能稍微扯上关系的业界巨头都对 Kubernetes 争相追捧，IBM、RedHat、Microsoft、VMware 和华为都是它最早期的代码贡献者。此时，云计算从实验室到工业化应用已经有十个年头，然而大量应用使用云计算的方式仍停滞在传统 IDC（Internet Data Center）时代，仅仅是用云端的虚拟机代替了传统的物理机。尽管早在 2013 年，Pivotal（持有着 Spring Framework 和 Cloud Foundry 的公司）就提出了“云原生”的概念，但是要实现服务化、具备韧性（Resilience）、弹性（Elasticity）、可观测性（Observability）的软件系统十分困难，在当时基本只能依靠架构师和程序员高超的个人能力，云计算本身帮不上什么忙。在云的时代不能充分利用云的强大能力，这让云计算厂商无比遗憾，也无比焦虑。直到 Kubernetes 横空出世，大家终于等到了破局的希望，认准了这就是云原生时代的操作系统，是让复杂软件在云计算下获得韧性、弹性、可观测性的最佳路径，也是为厂商们推动云计算时代加速到来的关键引擎之一。</p>
<p>2015 年 7 月，Kubernetes 发布了第一个正式版本 1.0 版，更重要的事件是 Google 宣布与 Linux 基金会共同筹建<a class="link"   target="_blank" rel="noopener" href="https://www.cncf.io/" >云原生基金会<i class="fas fa-external-link-alt"></i></a>（Cloud Native Computing Foundation，CNCF），并且将 Kubernetes 托管到 CNCF，成为其第一个项目。随后，Kubernetes 以摧枯拉朽之势覆灭了容器编排领域的其他竞争对手，哪怕 Docker Swarm 有着 Docker 在容器引擎方面的先天优势，DotCloud 后来甚至将 Swarm 直接内置入 Docker 之中都未能稍稍阻挡 Kubernetes 的前进的步伐。</p>
<p>Kubernetes 的成功与 Docker 的成功并不相同，Docker 靠的是优秀的理念，以一个“好点子”引爆了一个时代。笔者相信就算没有 Docker 也会有 Cocker 或者 Eocker 的出现，但由成立仅三年的 DotCloud 公司（三年后又倒闭）做成了这样的产品确实有一定的偶然性。而 Kubernetes 的成功不仅有 Google 深厚的技术功底作支撑，有领先时代的设计理念，更加关键的是 Kubernetes 的出现符合所有云计算大厂的切身利益，有着业界巨头不遗余力的广泛支持，它的成功便是一种必然。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA8AAAALTCAMAAADuPZsoAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MDNGRUYzN0YzMTExMUVBOTQyMzg3RUQyNzFEODNDOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3MDNGRUYzOEYzMTExMUVBOTQyMzg3RUQyNzFEODNDOCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcwM0ZFRjM1RjMxMTExRUE5NDIzODdFRDI3MUQ4M0M4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjcwM0ZFRjM2RjMxMTExRUE5NDIzODdFRDI3MUQ4M0M4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+p8HWOAAAAYBQTFRFuLi4AAAAzMzMZWVlmZmZmJiYsrKy5eXl9/f3enp67+/vsLCwXl5e3t7ekpKSS0tLhISEYWFhs7OzT09PPz8/XV1dhoaGl5eXrq6uoqKiz8/PcXFxbW1t39/ff39/v7+/EBAQn5+fX19fQkJCQEBADw8PLy8vr6+vj4+PxMTEp6enICAgMDAwu7u7gICA+fn5Hx8fYGBg5+fnTk5O7OzsWFhYaWlpnZ2db29vo6Ojm5ubUFBQtLS0ODg4cnJy2NjYt7e3k5OTWlpa+/v7q6ur0NDQgoKCqKioMTExUVFRxsbG7u7uREREoKCgjIyMcHBwkJCQTExMqqqqeHh43d3dx8fH9fX1bGxsNjY2zc3N6OjoVFRURkZGd3d31dXVOjo6jo6OwMDA4ODggYGB09PT0tLS8fHx9PT0tbW16enpiYmJZmZmdXV1TU1NVVVVPj4+Z2dnaGho1NTUNTU1qampurq6pKSknp6eRUVFSEhIioqKrKysQUFBMjIy////////p8edEQAAAIB0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wA4BUtnAAAnAklEQVR42uydiX/bRnpArZFiEwABSqYs2bptS7IOS7K9PhI7sZM4d7I59j66V9vdbne37ba77R7tiP9658BFCqREiTj13i/KkCBIYzDf4wzmA8ArPQCoLVfYBQAIDAAIDAAIDIDAAIDAAIDAAIDAAAgMAAgMFWLpq83Nr1bZDwgMNWR9c8qwuc6+QGCoqb4ojMBQO76d0tco/G32CQJDXfTdnzrBPgojMNRVXxRGYKgD7uEQfY3Chy57CIGhwvpuTI1kA4URGOqqLwojMFSV1YdTZ+Qh53YgMNRC3+1tFEZgqDrrQ3rfbq/XHdILr7PXEBiqoe/msMGysvTesNc4PQuBodL6Tk3dGyEwCiMwlK/v/VHTVWu93tqo1++jMAJDidwePd98p9e7M3qN2+xDBIayWDolYTTf682fssoSexGBoSTuXFzgO+xFBIaSOO3Mq9GTWPbMLPYiAkMVR9Dzd9bcXs9du7M9cjXO6UBgKIfhU1hbd/qObe/d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" alt="Kubernetes与容器引擎的调用关系"></p>
<p>Kubernetes 与 Docker 两者的关系十分微妙，把握住两者关系的变化过程，是理解 Kubernetes 架构演变与 CRI、OCI 规范的良好线索。在 Kubernetes 开源的早期，它是完全依赖且绑定 Docker 的，并没有过多考虑够日后有使用其他容器引擎的可能性。直至 Kubernetes 1.5 之前，Kubernetes 管理容器的方式都是通过内部的 DockerManager 向 Docker Engine 以 HTTP 方式发送指令，通过 Docker 来操作镜像的增删改查的，如上图最右边线路的箭头所示（图中的 kubelet 是集群节点中的代理程序，负责与管理集群的 Master 通信，其他节点的含义在后文介绍到时都会有解释）。将这个阶段 Kubernetes 与容器引擎的调用关系捋直，并结合上一节提到的 Docker 捐献 containerd 与 runC 后重构的调用，完整的调用链条如下所示：</p>
<blockquote>
<p>Kubernetes Master → kubelet → DockerManager → Docker Engine → containerd → runC</p>
</blockquote>
<p>2016 年，Kubernetes 1.5 版本开始引入“<a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/" >容器运行时接口<i class="fas fa-external-link-alt"></i></a>”（Container Runtime Interface，CRI），这是一个定义容器运行时应该如何接入到 kubelet 的规范标准，从此 Kubernetes 内部的 DockerManager 就被更为通用的 KubeGenericRuntimeManager 所替代（实际上在 1.6.6 之前都仍然可以看到 DockerManager），kubelet 与 KubeGenericRuntimeManager 之间通过 gRPC 协议通信。由于 CRI 是在 Docker 之后才发布的规范，Docker 是肯定不支持 CRI 的，所以 Kubernetes 又提供了 DockerShim 服务作为 Docker 与 CRI 的适配层，由它与 Docker Engine 以 HTTP 形式通信，实现了原来 DockerManager 的全部功能。此时，Docker 对 Kubernetes 来说只是一项默认依赖，而非之前的无可或缺了，它们的调用链为：</p>
<blockquote>
<p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → DockerShim → Docker Engine → containerd → runC</p>
</blockquote>
<p>2017 年，由 Google、RedHat、Intel、SUSE、IBM 联合发起的<a class="link"   target="_blank" rel="noopener" href="https://github.com/cri-o/cri-o" >CRI-O<i class="fas fa-external-link-alt"></i></a>（Container Runtime Interface Orchestrator）项目发布了首个正式版本。从名字就可以看出，它肯定是完全遵循 CRI 规范进行实现的，另一方面，它可以支持所有符合 OCI 运行时标准的容器引擎，默认仍然是与 runC 搭配工作的，若要换成<a class="link"   target="_blank" rel="noopener" href="https://github.com/clearcontainers" >Clear Containers<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://katacontainers.io/" >Kata Containers<i class="fas fa-external-link-alt"></i></a>等其他 OCI 运行时也完全没有问题。虽然开源版 Kubernetes 是使用 CRI-O、cri-containerd 抑或是 DockerShim 作为 CRI 实现，完全可以由用户自由选择（根据用户宿主机的环境选择），但在 RedHat 自己扩展定制的 Kubernetes 企业版，即<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/OpenShift" >OpenShift 4<i class="fas fa-external-link-alt"></i></a>中，调用链已经没有了 Docker Engine 的身影：</p>
<blockquote>
<p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → CRI-O→ runC</p>
</blockquote>
<p>由于此时 Docker 在容器引擎中的市场份额仍然占有绝对优势，对于普通用户来说，如果没有明确的收益，并没有什么动力要把 Docker 换成别的引擎，所以 CRI-O 即使摆出了直接挖掉 Docker 根基的凶悍姿势，其实也并没有给 Docker 带来太多即时可见的影响，不过能够想像此时 Docker 心中肯定充斥了难以言喻的危机感。</p>
<p>2018 年，由 Docker 捐献给 CNCF 的 containerd，在 CNCF 的精心孵化下发布了 1.1 版，1.1 版与 1.0 版的最大区别是此时它已完美地支持了 CRI 标准，这意味着原本用作 CRI 适配器的 cri-containerd 从此不再需要。此时，再观察 Kubernetes 到容器运行时的调用链，你会发现调用步骤会比通过 DockerShim、Docker Engine 与 containerd 交互的步骤要减少两步，这又意味着用户只要愿意抛弃掉 Docker 情怀的话，在容器编排上便可至少省略一次 HTTP 调用，获得性能上的收益，且根据 Kubernetes 官方给出的<a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/" >测试数据<i class="fas fa-external-link-alt"></i></a>，这些免费的收益还相当地可观。Kubernetes 从 1.10 版本宣布开始支持 containerd 1.1，在调用链中已经能够完全抹去 Docker Engine 的存在：</p>
<blockquote>
<p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → containerd → runC</p>
</blockquote>
<p>今天，要使用哪一种容器运行时取决于你安装 Kubernetes 时宿主机上的容器运行时环境，但对于云计算厂商来说，譬如国内的<a class="link"   target="_blank" rel="noopener" href="https://cn.aliyun.com/product/kubernetes" >阿里云 ACK<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://cloud.tencent.com/product/tke" >腾讯云 TKE<i class="fas fa-external-link-alt"></i></a>等直接提供的 Kubernetes 容器环境，采用的容器运行时普遍都已是 containerd，毕竟运行性能对它们来说就是核心生产力和竞争力。</p>
<p>未来，随着 Kubernetes 的持续发展壮大，Docker Engine 经历从不可或缺、默认依赖、可选择、直到淘汰是大概率事件，这件事情表面上是 Google、RedHat 等云计算大厂联手所为，实际淘汰它的还是技术发展的潮流趋势，就如同 Docker 诞生时依赖 LXC，到最后用 libcontainer 取代掉 LXC 一般。同时，我们也该看到事情的另一面，现在连 LXC 都还没有挂掉，反倒还发展出了更加专注于与 OpenVZ 等系统级虚拟化竞争的<a class="link"   target="_blank" rel="noopener" href="https://linuxcontainers.org/lxd/introduction/" >LXD<i class="fas fa-external-link-alt"></i></a>，相信 Docker 本身也很难彻底消亡的，已经养成习惯的 CLI 界面，已经形成成熟生态的镜像仓库等都应该会长期存在，只是在容器编排领域，未来的 Docker 很可能只会以 runC 和 containerd 的形式存续下去，毕竟它们最初都源于 Docker 的血脉。</p>
<h2 id="二、以容器构建系统"><a href="#二、以容器构建系统" class="headerlink" title="二、以容器构建系统"></a>二、以容器构建系统</h2><p>自从 Docker 提出“以封装应用为中心”的容器发展理念，成功取代了“以封装系统为中心”的 LXC 以后，一个容器封装一个单进程应用已经成为被广泛认可的最佳实践。然而单体时代过去之后，分布式系统里应用的概念已不再等同于进程，此时的应用需要多个进程共同协作，通过集群的形式对外提供服务，以虚拟化方法实现这个目标的过程就被称为容器编排（Container Orchestration）。</p>
<p>容器之间顺畅地交互通信是协作的核心需求，但容器协作并不仅仅是将容器以高速网络互相连接而已。如何调度容器，如何分配资源，如何扩缩规模，如何最大限度地接管系统中的非功能特性，让业务系统尽可能免受分布式复杂性的困扰都是容器编排框架必须考虑的问题，只有恰当解决了这一系列问题，云原生应用才有可能获得比传统应用更高的生产力。</p>
<h3 id="隔离与协作"><a href="#隔离与协作" class="headerlink" title="隔离与协作"></a>隔离与协作</h3><p>笔者并不打算过多介绍 Kubernetes 具体有哪些功能，向你说明 Kubernetes 由 Pod、Node、Deployment、ReplicaSet 等各种类型的资源组成可用的服务、集群管理平面与节点之间如何工作、每种资源该如何配置使用等等，并不是笔者的本意，如果你希望了解这方面信息，可以从 Kubernetes 官网的文档库或任何一本以 Kubernetes 为主题的使用手册中得到。</p>
<p>笔者真正希望说清楚的问题是“为什么 Kubernetes 会设计成现在这个样子？”、“为什么以容器构建系统应该这样做？”，寻找这些问题的答案最好是从它们设计的实现意图出发，为此，笔者虚构了一系列从简单到复杂的场景供你代入其中，理解并解决这些场景中的问题，并不要求你对 Kubernetes 已有多深入的了解，但要求你至少使用过 Kubernetes 和 Docker，基本了解它的核心功能与命令；此外还会涉及到一点儿 Linux 系统内核资源隔离的基础知识，别担心，只要你仔细读懂了上一节“<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/immutable-infrastructure/container/history.html" >容器的崛起<i class="fas fa-external-link-alt"></i></a>”，就已经完全够用了。</p>
<p>现在就来设想一下，如果让你来设计一套容器编排系统，协调各种容器来共同来完成一项工作，会遇到什么问题？会如何着手解决？让我们从最简单的场景出发：</p>
<blockquote>
<p><strong>场景一</strong>：假设你现在有两个应用，其中一个是 Nginx，另一个是为该 Nginx 收集日志的 Filebeat，你希望将它们封装为容器镜像，以方便日后分发。</p>
</blockquote>
<p>最直接的方案就将 Nginx 和 Filebeat 直接编译成同一个容器镜像，这是可以做到的，而且并不复杂，然而这样做会埋下很大隐患：它违背了 Docker 提倡的单个容器封装单进程应用的最佳实践。Docker 设计的 Dockerfile 只允许有一个 ENTRYPOINT，这并非无故添加的人为限制，而是因为 Docker 只能通过监视 PID 为 1 的进程（即由 ENTRYPOINT 启动的进程）的运行状态来判断容器的工作状态是否正常，容器退出执行清理，容器崩溃自动重启等操作都必须先判断状态。设想一下，即使我们使用了<a class="link"   target="_blank" rel="noopener" href="http://supervisord.org/" >supervisord<i class="fas fa-external-link-alt"></i></a>之类的进程控制器来解决同时启动 Nginx 和 Filebeat 进程的问题，如果因某种原因它们不停发生崩溃、重启，那 Docker 也无法察觉到，它只能观察到 supervisord 的运行状态，因此，以上需求会理所当然地演化成场景二。</p>
<blockquote>
<p><strong>场景二</strong>：假设你现在有两个 Docker 镜像，其中一个封装了 HTTP 服务，为便于称呼，我们叫它 Nginx 容器，另一个封装了日志收集服务，我们叫它 Filebeat 容器。现在要求 Filebeat 容器能收集 Nginx 容器产生的日志信息。</p>
</blockquote>
<p>场景二依然不难解决，只要在 Nginx 容器和 Filebeat 容器启动时，分别将它们的日志目录和收集目录挂载为宿主机同一个磁盘位置的 Volume 即可，这种操作在 Docker 中是十分常用的容器间信息交换手段。不过，容器间信息交换不仅仅是文件系统，假如此时我又引入了一个新的工具<a class="link"   target="_blank" rel="noopener" href="https://github.com/kelseyhightower/confd" >confd<i class="fas fa-external-link-alt"></i></a>——Linux 下的一种配置管理工具，作用是根据配置中心（Etcd、ZooKeeper、Consul）的变化自动更新 Nginx 的配置，这里便又会遇到新的问题。confd 需要向 Nginx 发送 HUP 信号以便<a class="link"   target="_blank" rel="noopener" href="http://nginx.org/en/docs/control.html" >通知 Nginx<i class="fas fa-external-link-alt"></i></a>配置已经发生了变更，而发送 HUP 信号自然要求 confd 与 Nginx 能够进行 IPC 通信才行。尽管共享 IPC 名称空间不如共享 Volume 常见，但 Docker 同样支持了该功能，docker run 提供了<code>--ipc</code>参数，用于把多个容器挂载到同一个父容器的 IPC 名称空间之下，以实现容器间共享 IPC 名称空间的需求。类似地，如果要共享 UTS 名称空间，可以使用<code>--uts</code>参数，要共享网络名称空间的话，就使用<code>--net</code>参数。</p>
<p>以上便是 Docker 针对场景二这种不跨机器的多容器协作所给出的解决方案，自动地为多个容器设置好共享名称空间其实就是<a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/compose/" >Docker Compose<i class="fas fa-external-link-alt"></i></a>提供的核心能力。这种针对具体应用需求来共享名称空间的方案，的确可以工作，却并不够优雅，也谈不上有什么扩展性。容器的本质是对 cgroups 和 namespaces 所提供的隔离能力的一种封装，在 Docker 提倡的单进程封装的理念影响下，容器蕴含的隔离性也多了仅针对于单个进程的额外局限，然而 Linux 的 cgroups 和 namespaces 原本都是针对进程组而不仅仅是单个进程来设计的，同一个进程组中的多个进程天然就可以共享着相同的访问权限与资源配额。如果现在我们把容器与进程在概念上对应起来，那容器编排的第一个扩展点，就是要找到容器领域中与“进程组”相对应的概念，这是实现容器从隔离到协作的第一步，在 Kubernetes 的设计里，这个对应物叫作 Pod。</p>
<p>额外知识：Pod 名字的由来与含义</p>
<p>Pod 的概念在容器正式出现之前的 Borg 系统中就已经存在，从 Google 的发表的《<a class="link"   target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.824/papers/borg.pdf" >Large-Scale Cluster Management at Google with Borg<i class="fas fa-external-link-alt"></i></a>》可以看出，Kubernetes 时代的 Pod 整合了 Borg 时代的“Prod”（Production Task 的缩写）与“Non-Prod”的职能。由于 Pod 一直没有权威的中文翻译，笔者在后续文章中会尽量用英文指代，偶尔需要中文的场合就使用 Borg 中 Prod 的译法，即“生产任务”来指代。</p>
<p>有了“容器组”的概念，场景二的问题便只需要将多个容器放到同一个 Pod 中即可解决。扮演容器组的角色，满足容器共享名称空间的需求，是 Pod 的两大最基本职责之一，同处于一个 Pod 内的多个容器，相互之间以超亲密的方式协作。请注意，“超亲密”在这里并非某种带强烈感情色彩的形容词，而是有一种有具体定义的协作程度。对于普通非亲密的容器，它们一般以网络交互方式（其他譬如共享分布式存储来交换信息也算跨网络）协作；对亲密协作的容器，是指它们被调度到同一个集群节点上，可以通过共享本地磁盘等方式协作；而超亲密的协作是特指多个容器位于同一个 Pod 这种特殊关系，它们将默认共享：</p>
<ul>
<li><strong>UTS 名称空间</strong>：所有容器都有相同的主机名和域名。</li>
<li><strong>网络名称空间</strong>：所有容器都共享一样的网卡、网络栈、IP 地址，等等。因此，同一个 Pod 中不同容器占用的端口不能冲突。</li>
<li><strong>IPC 名称空间</strong>：所有容器都可以通过信号量或者 POSIX 共享内存等方式通信。</li>
<li><strong>时间名称空间</strong>：所有容器都共享相同的系统时间。</li>
</ul>
<p>同一个 Pod 的容器，只有 PID 名称空间和文件名称空间默认是隔离的。PID 的隔离令每个容器都有独立的进程 ID 编号，它们封装的应用进程就是 PID 为 1 的进程，可以通过 Pod 元数据定义中的<code>spec.shareProcessNamespace</code>来改变这点。一旦要求共享 PID 名称空间，容器封装的应用进程就不再具有 PID 为 1 的特征了，这有可能导致部分依赖该特征的应用出现异常。在文件名称空间方面，容器要求文件名称空间的隔离是很理所当然的需求，因为容器需要相互独立的文件系统以避免冲突。但容器间可以共享存储卷，这是通过 Kubernetes 的 Volume 来实现的。</p>
<p>额外知识：Kubernetes 中 Pod 名称空间共享的实现细节</p>
<p>Pod 内部多个容器共享 UTS、IPC、网络等名称空间是通过一个名为 Infra Container 的容器来实现的，这个容器是整个 Pod 中第一个启动的容器，只有几百 KB 大小（代码只有很短的几十行，见<a class="link"   target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/tree/master/build/pause" >这里<i class="fas fa-external-link-alt"></i></a>），Pod 中的其他容器都会以 Infra Container 作为父容器，UTS、IPC、网络等名称空间实质上都是来自 Infra Container 容器。</p>
<p>如果容器设置为共享 PID 名称空间的话，Infra Container 中的进程将作为 PID 1 进程，其他容器的进程将以它的子进程的方式存在，此时将由 Infra Container 来负责进程管理（譬如清理<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Zombie_process" >僵尸进程<i class="fas fa-external-link-alt"></i></a>）、感知状态和传递状态。</p>
<p>由于 Infra Container 的代码除了注册 SIGINT、SIGTERM、SIGCHLD 等信号的处理器外，就只是一个以 pause()方法为循环体的无限循环，永远处于 Pause 状态，所以也常被称为“Pause Container”。</p>
<p>Pod 的另外一个基本职责是实现原子性调度，如果容器编排不跨越集群节点，是否具有原子性都无关紧要。但是在集群环境中，容器可能跨机器调度时，这个特性就变得非常重要。如果以容器为单位来调度的话，不同容器就有可能被分配到不同机器上。两台机器之间本来就是物理隔离，依靠网络连接的，这时候谈什么名称空间共享、<code>cgroups</code>配额共享都失去了意义，我们由此从场景二又演化出以下场景三。</p>
<blockquote>
<p><strong>场景三</strong>：假设你现在有 Filebeat、Nginx 两个 Docker 镜像，在一个具有多个节点的集群环境下，要求每次调度都必须让 Filebeat 和 Nginx 容器运行于同一个节点上。</p>
</blockquote>
<p>两个关联的协作任务必须一起调度的需求在容器出现之前就存在已久，譬如在传统的多线程（或多进程）<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Concurrency_(computer_science)" >并发调度<i class="fas fa-external-link-alt"></i></a>中，如果两个线程（或进程）的工作是强依赖的，单独给谁分配处理时间、而另一个被挂起都会导致程序无法工作，如此就有了<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Coscheduling" >协同调度<i class="fas fa-external-link-alt"></i></a>（Coscheduling）的概念，以保证一组紧密联系的任务能够被同时分配资源。如果我们在容器编排中仍然坚持将容器视为调度的最小粒度，那对容器运行所需资源的需求声明就只能设定在容器上，这样集群每个节点剩余资源越紧张，单个节点无法容纳全部协同容器的概率就越大，协同的容器被分配到不同节点的可能性就越高。</p>
<p>协同调度是十分麻烦的，实现起来要么很低效，譬如 Apache Mesos 的 Resource Hoarding 调度策略，就要等所有需要调度的任务都完备后才会开始分配资源；要么就会实现得很复杂，譬如 Google 就曾针对 Borg 的下一代 Omega 系统发表过论文《<a class="link"   target="_blank" rel="noopener" href="https://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/41684.pdf" >Omega: Flexible, Scalable Schedulers for Large Compute Clusters<i class="fas fa-external-link-alt"></i></a>》介绍它如何使用通过乐观并发（Optimistic Concurrency）、冲突回滚的方式做到高效率，也同样高度复杂的协同调度。但是如果将运行资源的需求声明定义在 Pod 上，直接以 Pod 为最小的原子单位来实现调度的话，由于多个 Pod 之间必定不存在超亲密的协同关系，只会通过网络非亲密地协作，那就根本没有协同的说法，自然也不需要考虑复杂的调度了，关于 Kubernetes 的具体调度实现，笔者会在“<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/immutable-infrastructure/schedule/hardware-schedule.html" >资源与调度<i class="fas fa-external-link-alt"></i></a>”中展开讲解。</p>
<p>Pod 是隔离与调度的基本单位，也是我们接触的第一种 Kubernetes 资源。Kubernetes 将一切皆视为资源，不同资源之间依靠层级关系相互组合协作，这个思想是贯穿 Kubernetes 整个系统的两大核心设计理念之一，不仅在容器、Pod、主机、集群等计算资源上是这样，在工作负载、持久存储、网络策略、身份权限等其他领域中也都有着一致的体现。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkoAAAD1CAMAAACY/ioiAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEMUQ0NENEQkYxQ0ExMUVBODA0OUZFNkJCNEZEMkFBRSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEMUQ0NENEQ0YxQ0ExMUVBODA0OUZFNkJCNEZEMkFBRSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkQxRDQ0Q0Q5RjFDQTExRUE4MDQ5RkU2QkI0RkQyQUFFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkQxRDQ0Q0RBRjFDQTExRUE4MDQ5RkU2QkI0RkQyQUFFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+0zTd5QAAAHJQTFRFzMzM7+/vXl5e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" alt="Kubernetes 的计算资源"></p>
<p>由于 Pod 是 Kubernetes 中最重要的资源，又是资源模型中一种仅在逻辑上存在、没有物理对应的概念（因为对应的“进程组”也只是个逻辑概念），是其他编排系统没有的概念，所以笔者专门花费了一些篇幅去介绍它的设计意图，而不是像帮助手册那样直接给出它的作用和特性。对于 Kubernetes 中的其他计算资源，像 Node、Cluster 等都有切实的物理对应物，很容易就能形成共同的认知，笔者也就不必逐一介绍了，仅将它们的设计意图列举如下：</p>
<ul>
<li><strong>容器</strong>（Container）：延续了自 Docker 以来一个容器封装一个应用进程的理念，是镜像管理的最小单位。</li>
<li><strong>生产任务</strong>（Pod）：补充了容器化后缺失的与进程组对应的“容器组”的概念，Pod 中容器共享 UTS、IPC、网络等名称空间，是资源调度的最小单位。</li>
<li><strong>节点</strong>（Node）：对应于集群中的单台机器，这里的机器即可以是生产环境中的物理机，也可以是云计算环境中的虚拟节点，节点是处理器和内存等资源的资源池，是硬件单元的最小单位。</li>
<li><strong>集群</strong>（Cluster）：对应于整个集群，Kubernetes 提倡理念是面向集群来管理应用。当你要部署应用的时候，只需要通过声明式 API 将你的意图写成一份元数据（Manifests），将它提交给集群即可，而无需关心它具体分配到哪个节点（尽管通过标签选择器完全可以控制它分配到哪个节点，但一般不需要这样做）、如何实现 Pod 间通信、如何保证韧性与弹性，等等，所以集群是处理元数据的最小单位。</li>
<li><strong>集群联邦</strong>（Federation）：对应于多个集群，通过联邦可以统一管理多个 Kubernetes 集群，联邦的一种常见应用是支持跨可用区域多活、跨地域容灾的需求。</li>
</ul>
<h3 id="韧性与弹性"><a href="#韧性与弹性" class="headerlink" title="韧性与弹性"></a>韧性与弹性</h3><p>笔者曾看过一部叫作《<a class="link"   target="_blank" rel="noopener" href="https://movie.douban.com/subject/1296612/" >Bubble Boy<i class="fas fa-external-link-alt"></i></a>》的电影，讲述了一个体内没有任何免疫系统的小男孩，终日只能生活在无菌的圆形气球里，对常人来说不值一提的细菌，都能够直接威胁到他的性命。小男孩尽管能够降生于世间，但并不能真正与世界交流，这种生命是极度脆弱的。</p>
<p>真实世界的软件系统与电影世界中的小男孩亦具有可比性。让容器得以相互连通，相互协作仅仅是以容器构建系统的第一步，我们不仅希望得到一个能够运行起来的系统，而且还希望得到一个能够健壮运行的系统、能够抵御意外与风险的系统。在 Kubernetes 的支持下，你确实可以直接创建 Pod 将应用运行起来，但这样的应用就如同电影中只能存活在气球中的小男孩一般脆弱，无论是软件缺陷、意外操作或者硬件故障，都可能导致在复杂协作的过程中某个容器出现异常，进而出现系统性的崩溃。为此，架构师专门设计了<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/distribution/traffic-management/failure.html" >服务容错<i class="fas fa-external-link-alt"></i></a>的策略和模式，Kubernetes 作为云原生时代的基础设施，也尽力帮助程序员以最小的代价来实现容错，为系统健壮运行提供底层支持。</p>
<p>如何实现具有韧性与弹性的系统是展示 Kubernetes 控制器设计模式的最好示例，控制器模式是继资源模型之后，本节介绍的另一个 Kubernetes 核心设计理念。下面，我们就从如何解决以下场景四的问题开始。</p>
<blockquote>
<p><strong>场景四</strong>：假设有一个由数十个 Node、数百个 Pod、近千个 Container 所组成的分布式系统，要避免系统因为外部流量压力、代码缺陷、软件更新、硬件升级、资源分配等各种原因而出现中断，作为管理员，你希望编排系统能为你提供何种支持？</p>
</blockquote>
<p>作为用户，当然最希望容器编排系统能自动把所有意外因素都消灭掉，让任何每一个服务都永远健康，永不出错。但永不出错的服务是不切实际的，只有凑齐七颗龙珠才有望办到。那就只能退而求其次，让编排系统在这些服务出现问题，运行状态不正确的时候，能自动将它们调整成正确的状态。这种需求听起来也是贪心的，却已经具备足够的可行性，应对的解决办法在<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Industrial_control_system" >工业控制系统<i class="fas fa-external-link-alt"></i></a>里已经有非常成熟的应用，叫作<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Control_loop" >控制回路<i class="fas fa-external-link-alt"></i></a>（Control Loop）。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/architecture/controller/" >Kubernetes 官方文档<i class="fas fa-external-link-alt"></i></a>是以房间中空调自动调节温度为例子介绍了控制回路的一般工作过程的：当你设置好了温度，就是告诉空调你对温度的“期望状态”（Desired State），而传感器测量出的房间实际温度是“当前状态”（Current State）。根据当前状态与期望状态的差距，控制器对空调制冷的开关进行调节控制，就能让其当前状态逐渐接近期望状态。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAn0AAADTCAMAAADDJFVIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyRUY4N0VDOUYzMTQxMUVBODVEMEQxNDVFRTFBODdCNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoyRUY4N0VDQUYzMTQxMUVBODVEMEQxNDVFRTFBODdCNiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjJFRjg3RUM3RjMxNDExRUE4NUQwRDE0NUVFMUE4N0I2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjJFRjg3RUM4RjMxNDExRUE4NUQwRDE0NUVFMUE4N0I2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+idMkggAAAX1QTFRFsLCwzMzMkpKS3t7e7+/v9/f3enp6hoaGS0tLXl5ebW1tnZ2dp6en1NTUxMTE5+fniIiIUVFR1dXV8fHxaWlp2NjYWFhY39/fwsLCXV1dsbGxzc3NioqK7OzsZ2dn0NDQubm52dnZu7u7k5OToaGhTExM7u7uj4+P+fn51tbWXFxc5OTkgoKC6enpfn5+dnZ2U1NTT09PxsbGY2Njg4ODoKCgOzs7hISE+/v7+vr6PDw8s7OzOjo6RUVFODg4Pj4+MTEx4uLiR0dHX19fVlZWjY2N9PT0pKSktLS0mpqa8/PzQUFBcnJykJCQa2trWlpaWVlZPz8/REREvb2929vbm5ub9fX1y8vLbm5uZWVlUFBQlpaW4ODg/f39qKiowMDAyMjIo6OjQEBAtra2jo6OYWFhq6urn5+ft7e3QkJCbGxsRkZGrq6u4eHhpaWlqampdXV1urq6tbW1UlJS5eXl5ubmf39/pqamv7+/+Pj46OjoMjIymZmZ////////Se+07gAAAH90Uk5T////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP/hPAkAAA04SURBVHja7N2Nf9PGGQfwu5N0kvyShCSEvPGSEAJJIGkggfI2RkvL2q5dNzpgg64MunXQ9/d2T+W/vXcnyZYVG2xJtgz+/T4tMXIcdNZXz73YjlgDQcoKw1OAQB8CfQgCfQj0IQj0IdB3IFbFbjAy0T/Glrb+s2J1/He4vp+rb/XU/Uw0wkdKp9HgQt/fZUfCH6q++kRVP/zHeLTZch0cwPGtfYpfqCb8kytLjuz4E4Vh46+KhuNaobsai/yI1UgVdXqokE6kUPDWVi5E9BgJgePb8zZrn+VRHM/qWvuMvgZnjVbtC6tbh9pn+82fSMKWk8JOmNQSUfvGXl+i9jVCVl2V+nHPy5kgpgFpP6oXjgiLzp2uKXW25NW2ohtp920cw7HUp2pT4tGObBWqxgtqn1BDt/D7pWP7Iu64RcduN+xwbVnlEVIlTvh2WPgSQpExq32Mxb1j2NmypJ+II2urfaG+eJCoax971q32mSK3YMX6jhhoYZf7DLUP+qJu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" alt="控制回路"></p>
<p>将这种控制回路的思想迁移应用到容器编排上，自然会为 Kubernetes 中的资源附加上了期望状态与实际状态两项属性。不论是已经出现在上节的资源模型中，用于抽象容器运行环境的计算资源，还是没有登场的另一部分对应于安全、服务、令牌、网络等功能的资源，用户要想使用这些资源来实现某种需求，并不提倡像平常编程那样去调用某个或某一组方法来达成目的，而是通过描述清楚这些资源的期望状态，由 Kubernetes 中对应监视这些资源的控制器来驱动资源的实际状态逐渐向期望状态靠拢，以此来达成目的。这种交互风格被称为是 Kubernetes 的声明式 API，如果你已有过实际操作 Kubernetes 的经验，那你日常在元数据文件中的<code>spec</code>字段所描述的便是资源的期望状态。</p>
<p>额外知识：Kubernates 的资源对象与控制器</p>
<p>目前，Kubernetes 已内置支持相当多的资源对象，并且还可以使用<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/immutable-infrastructure/extension/crd.html" >CRD<i class="fas fa-external-link-alt"></i></a>（Custom Resource Definition）来自定义扩充，你可以使用<code>kubectl api-resources</code>来查看它们。笔者根据用途分类列举了以下常见的资源：</p>
<ul>
<li>用于描述如何创建、销毁、更新、扩缩 Pod，包括：Autoscaling（HPA）、CronJob、DaemonSet、Deployment、Job、Pod、ReplicaSet、StatefulSet</li>
<li>用于配置信息的设置与更新，包括：ConfigMap、Secret</li>
<li>用于持久性地存储文件或者 Pod 之间的文件共享，包括：Volume、LocalVolume、PersistentVolume、PersistentVolumeClaim、StorageClass</li>
<li>用于维护网络通信和服务访问的安全，包括：SecurityContext、ServiceAccount、Endpoint、NetworkPolicy</li>
<li>用于定义服务与访问，包括：Ingress、Service、EndpointSlice</li>
<li>用于划分虚拟集群、节点和资源配额，包括：Namespace、Node、ResourceQuota</li>
</ul>
<p>这些资源在控制器管理框架中一般都会有相应的控制器来管理，笔者列举常见的控制器，按照它们的启动情况分类如下：</p>
<ul>
<li>必须启用的控制器：EndpointController、ReplicationController、PodGCController、ResourceQuotaController、NamespaceController、ServiceAccountController、GarbageCollectorController、DaemonSetController、JobController、DeploymentController、ReplicaSetController、HPAController、DisruptionController、StatefulSetController、CronJobController、CSRSigningController、CSRApprovingController、TTLController</li>
<li>默认启用的可选控制器，可通过选项禁止：TokenController、NodeController、ServiceController、RouteController、PVBinderController、AttachDetachController</li>
<li>默认禁止的可选控制器，可通过选项启用：BootstrapSignerController、TokenCleanerController</li>
</ul>
<p>与资源相对应，只要是实际状态有可能发生变化的资源对象，通常都会由对应的控制器进行追踪，每个控制器至少会追踪一种类型的资源。为了管理众多资源控制器，Kubernetes 设计了统一的控制器管理框架（<a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-controller-manager/" >kube-controller-manager<i class="fas fa-external-link-alt"></i></a>）来维护这些控制器的正常运作，以及统一的指标监视器（<a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-apiserver/" >kube-apiserver<i class="fas fa-external-link-alt"></i></a>）来为控制器工作时提供其追踪资源的度量数据。</p>
<p>由于毕竟不是在写 Kubernetes 的操作手册，笔者只能针对两三种资源和控制器为代表来举例说明，而无法将每个控制器都详细展开讲解。这里只要将场景四进一步具体化，转换成下面的场景五，便可以得到一个很好的例子，以部署控制器（Deployment Controller）、副本集控制器（ReplicaSet Controller）和自动扩缩控制器（HPA Controller）为例来介绍 Kubernetes 控制器模式的工作原理。</p>
<blockquote>
<p><strong>场景五</strong>：通过服务编排，对任何分布式系统自动实现以下三种通用的能力：</p>
<ol>
<li>Pod 出现故障时，能够自动恢复，不中断服务；</li>
<li>Pod 更新程序时，能够滚动更新，不中断服务；</li>
<li>Pod 遇到压力时，能够水平扩展，不中断服务；</li>
</ol>
</blockquote>
<p>前文曾提到虽然 Pod 本身也是资源，完全可以直接创建，但由 Pod 直接构成的系统是十分脆弱的，犹如气球中的小男孩，生产中并不提倡。正确的做法是通过副本集（ReplicaSet）来创建 Pod。ReplicaSet 也是一种资源，是属于工作负荷一类的资源，它代表一个或多个 Pod 副本的集合，你可以在 ReplicaSet 资源的元数据中描述你期望 Pod 副本的数量（即<code>spec.replicas</code>的值）。当 ReplicaSet 成功创建之后，副本集控制器就会持续跟踪该资源，如果一旦有 Pod 发生崩溃退出，或者状态异常（默认是靠进程返回值，你还可以在 Pod 中设置探针，以自定义的方式告诉 Kubernetes 出现何种情况 Pod 才算状态异常），ReplicaSet 都会自动创建新的 Pod 来替代异常的 Pod；如果异常多出现了额外数量的 Pod，也会被 ReplicaSet 自动回收掉，总之就是确保任何时候集群中这个 Pod 副本的数量都向期望状态靠拢。</p>
<p>ReplicaSet 本身就能满足场景五中的第一项能力，可以保证 Pod 出现故障时自动恢复，但是在升级程序版本时，ReplicaSet 不得不主动中断旧 Pod 的运行，重新创建新版的 Pod，这会造成服务中断。对于那些不允许中断的业务，以前的 Kubernetes 曾经提供过<code>kubectl rolling-update</code>命令来辅助实现滚动更新。</p>
<p>所谓<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rolling_release" >滚动更新<i class="fas fa-external-link-alt"></i></a>（Rolling Updates）是指先停止少量旧副本，维持大量旧副本继续提供服务，当停止的旧副本更新成功，新副本可以提供服务以后，再重复以上操作，直至所有的副本都更新成功。将这个过程放到 ReplicaSet 上，就是先创建新版本的 ReplicaSet，然后一边让新 ReplicaSet 逐步创建新版 Pod 的副本，一边让旧的 ReplicaSet 逐渐减少旧版 Pod 的副本。</p>
<p>之所以<code>kubectl rolling-update</code>命令会被淘汰，是因为这样的命令式交互完全不符合 Kubernetes 的设计理念（这是台面上的说法，笔者觉得淘汰的根本原因主要是因为它不够好用），如果你希望改变某个资源的某种状态，应该将期望状态告诉 Kubernetes，而不是去教 Kubernetes 具体该如何操作。因此，新的部署资源（Deployment）与部署控制器被设计出来，可以由 Deployment 来创建 ReplicaSet，再由 ReplicaSet 来创建 Pod，当你更新 Deployment 中的信息（譬如更新了镜像的版本）以后，部署控制器就会跟踪到你新的期望状态，自动地创建新 ReplicaSet，并逐渐缩减旧的 ReplicaSet 的副本数，直至升级完成后彻底删除掉旧 ReplicaSet，如图 11-6 所示。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABB4AAAFYCAMAAADDQc/XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMEY3QThENEYzM0QxMUVBQTkwOUU5QjRGNDQ2OEZBNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowMEY3QThENUYzM0QxMUVBQTkwOUU5QjRGNDQ2OEZBNiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAwRjdBOEQyRjMzRDExRUFBOTA5RTlCNEY0NDY4RkE2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAwRjdBOEQzRjMzRDExRUFBOTA5RTlCNEY0NDY4RkE2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+CC+j4QAAAYBQTFRFvr6+oKCgZWVlNDQ0enp6hoaGkpKSwcHBiYmJ6urqUFBQqKio1NTUVFRUs7OznZ2dfHx8np6eREREmJiYuc7lu7u7+fn50dHRxMTEU1heXmVtOjo69fX15ubmbW1tQEBAq6urlpaWXFxccHqFrq6umaq7dH6J2NjYYWFhTVFWdHR0PT098vLygYGBTU1Ntra2WlparKys0tLSfn5+uLi4aWlp6Ojobm5uo6Oj3NzcYWlx/Pz8tcrg8PDw+vr6ysrKvLy8fYmWhISE4+PjSEhIS0tLcnJyjIyManR9rMDUUlddJiYmzMzM7+/v9/f3Xl5ewNfv3t7esLCwprjMaHF6xt73s8jekaCwcXFx19fXeoaSycnJWFhYyMjI39/fRUhLcHBwp6en5OTkkaGxpaWlj4+P7u7u1tbWz8/PvdTrnrDCqLvPk6Ozf4uYyuP9v9buxNz1sbGxS09Th5WkQ0ZJrL/Ux9/4go+doLLEj56u4ODg5eXlMjIyzOX/////////VhciVQAAAIB0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wA4BUtnAAAnYUlEQVR42uydi1sbxxXFEUgyBgwEjI2NTWzsuA6Jk7SWX3XStLWpk3QlIYmHwOBnnLh5O2mbNBpp//XOzK4EK+1K+5jXSud++SIh8GjvT2fOzszeHY3ZCAQC4RtjQIBAIGAPCAQC9oBAIGAPCAQC9oBAIGAPCAQC9oBAIGAPCAQC9pDWWFwEA7AAC9iDb/zzn2AAFmABe4AMwAIsYA+QAViABewBMgALsIA9QAZgARawB8gALMAC9gAZgAVYwB4gA7AAC9gDZAAWYAF7gAzAAixgD5ABWIAF7AEyQIAFWMAeIAOwAIuhsweLkI2KXcpaAb+vrBbNloGsBJR1iRQkAHsYUXuwykW79LzUI85qtpQOe5CWgKoukYYEYA8jag/5Kn9Irz1IS0BVl0hDArCHUbUHR4Sl7HKWEMsuli1+PssTQqr0J0KeU3GWsnz8y85zlQ2LKdnKLhOSN8IeZCWgzB5SkADsYUTtoVguF7k4qfioUNvi5OeuYrlK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" alt="Deployment 滚动更新过程"></p>
<p>对于场景五的最后一种情况，遇到流量压力时，管理员完全可以手动修改 Deployment 中的副本数量，或者通过<code>kubectl scale</code>命令指定副本数量，促使 Kubernetes 部署更多的 Pod 副本来应对压力，然而这种扩容方式不仅需要人工参与，且只靠人类经验来判断需要扩容的副本数量，不容易做到精确与及时。为此 Kubernetes 又提供了 Autoscaling 资源和自动扩缩控制器，能够自动根据度量指标，如处理器、内存占用率、用户自定义的度量值等，来设置 Deployment（或者 ReplicaSet）的期望状态，实现当度量指标出现变化时，系统自动按照“Autoscaling→Deployment→ReplicaSet→Pod”这样的顺序层层变更，最终实现根据度量指标自动扩容缩容。</p>
<p>故障恢复、滚动更新、自动扩缩这些特性，在云原生中时代里常被概括成服务的弹性（Elasticity）与韧性（Resilience），ReplicaSet、Deployment、Autoscaling 的用法，也属于是所有 Kubernetes 教材资料都会讲到的“基础必修课”。如果你准备学习 Kubernetes 或者其他云原生相关技术，笔者建议最好不要死记硬背地学习每个资源的元数据文件该如何编写、有哪些指令、有哪些功能，更好的方式是站在解决问题的角度去理解为什么 Kubernetes 要设计这些资源和控制器，理解为什么这些资源和控制器会被设计成现在这种样子。</p>
<p>如果你觉得已经理解了前面的几种资源和控制器的例子，那不妨思考一下以下几个问题：假设我想限制某个 Pod 持有的最大存储卷数量，应该会如何设计？假设集群中某个 Node 发生硬件故障，Kubernetes 要让调度任务避开这个 Node，应该如何设计？假设一旦这个 Node 重新恢复，Kubernetes 要能尽快利用上面的资源，又该如何去设计？只要你真正接受了资源与控制器是贯穿整个 Kubernetes 的两大设计理念，即便不去查文档手册，也应该能推想出个大概轮廓，以此为基础当你再去看手册或者源码时，想必就能够事半功倍。</p>
<h2 id="以应用为中心的封装"><a href="#以应用为中心的封装" class="headerlink" title="以应用为中心的封装"></a>以应用为中心的封装</h2><p>看完容器技术发展的历程，不知你会不会感到有种“套娃式”的迷惑感？容器的崛起缘于 chroot、namespaces、cgroups 等内核提供的隔离能力，系统级虚拟化技术使得同一台机器上互不干扰地运行多个服务成为可能；为了降低用户使用内核隔离能力的门槛，随后出现了 LXC，它是 namespaces、cgroups 特性的上层封装，使得“容器”一词真正走出实验室，走入工业界实际应用；为了实现跨机器的软件绿色部署，出现了 Docker，它（最初）是 LXC 的上层封装，彻底改变了软件打包分发的方式，迅速被大量企业广泛采用；为了满足大型系统对服务集群化的需要，出现了 Kubernetes，它（最初）是 Docker 的上层封装，让以多个容器共同协作构建出健壮的分布式系统，成为今天云原生时代的技术基础设施。</p>
<p>那 Kubernetes 会是容器化崛起之路的终点线吗？它达到了人们对云原生时代技术基础设施的期望了吗？从能力角度讲，是可以说是的，Kubernetes 被誉为云原生时代的操作系统，自诞生之日起就因其出色的管理能力、扩展性与以声明代替命令的交互理念收获了无数喝彩声；但是，从易用角度讲，坦白说差距还非常大，云原生基础设施的其中一个重要目标是接管掉业务系统复杂的非功能特性，让业务研发与运维工作变得足够简单，不受分布式的牵绊，然而 Kubernetes 被诟病得最多的就是复杂，自诞生之日起就以陡峭的学习曲线而闻名。</p>
<p>举个具体例子，用 Kubernetes 部署一套<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/exploration/projects/microservice_arch_springcloud.html" >Spring Cloud 版的 Fenix’s Bookstore<i class="fas fa-external-link-alt"></i></a>，你需要分别部署一个到多个的配置中心、注册中心、服务网关、安全认证、用户服务、商品服务、交易服务，对每个微服务都配置好相应的 Kubernetes 工作负载与服务访问，为每一个微服务的 Deployment、ConfigMap、StatefulSet、HPA、Service、ServiceAccount、Ingress 等资源都编写好元数据配置。这个过程最难的地方不仅在于繁琐，还在于要写出合适的元数据描述文件，既需要懂的开发（网关中服务调用关系、使用容器的镜像版本、运行依赖的环境变量这些参数等等，只有开发最清楚），又需要懂运维（要部署多少个服务，配置何种扩容缩容策略、数据库的密钥文件地址等等，只有运维最清楚），有时候还需要懂平台（需要什么的调度策略，如何管理集群资源，通常只有平台组、中间件组或者核心系统组的同学才会关心），一般企业根本找不到合适的角色来为它管理、部署和维护应用。</p>
<p>这个事儿 Kubernetes 心里其实也挺委屈，因为以上复杂性不能说是 Kubernetes 带来的，而是分布式架构本身的原罪。对于大规模的分布式集群，无论是最终用户部署应用，还是软件公司管理应用都存在诸多痛点。这些困难的实质源于 Docker 容器镜像封装了单个服务，Kubernetes 通过资源封装了服务集群，却没有一个载体真正封装整个应用，将原本属于应用内部的技术细节圈禁起来，不要暴露给最终用户、系统管理员和平台维护者，让使用者去埋单；应用难以管理矛盾在于封装应用的方法没能将开发、运维、平台等各种角色的关注点恰当地分离。</p>
<p>既然微服务时代，应用的形式已经不再限于单个进程，那也该到了重新定义“以应用为中心的封装”这句话的时候了。至于具体怎样的封装才算是正确，今天还未有特别权威的结论，不过经过人们的尝试探索，已经窥见未来容器应用的一些雏形，笔者将近几年来研究的几种主流思路列出供你参考。</p>
<h3 id="Kustomize"><a href="#Kustomize" class="headerlink" title="Kustomize"></a>Kustomize</h3><p>最初，由 Kubernetes 官方给出“如何封装应用”的解决方案是“用配置文件来配置配置文件”，这不是绕口令，你可以理解为一种针对 YAML 的模版引擎的变体。Kubernetes 官方认为应用就是一组具有相同目标的 Kubernetes 资源的集合，如果逐一管理、部署每项资源元数据过于繁琐的话，那就提供一种便捷的方式，把应用中不变的信息与易变的信息分离开来解决管理问题，把应用所有涉及的资源自动生成一个多合一（All-in-One）的整合包来解决部署问题。</p>
<p>完成这项工作的工具叫作<a class="link"   target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/kustomize" >Kustomize<i class="fas fa-external-link-alt"></i></a>，它原本只是一个独立的小程序，从 Kubernetes 1.14 起，被吸纳入<code>kubectl</code>命令之中，成为随着 Kubernetes 提供的内置功能。Kustomize 使用<a class="link"   target="_blank" rel="noopener" href="https://kubernetes-sigs.github.io/kustomize/api-reference/glossary/" >Kustomization 文件<i class="fas fa-external-link-alt"></i></a>来组织与应用相关的所有资源，Kustomization 本身也是一个以 YAML 格式编写的配置文件，里面定义了构成应用的全部资源，以及资源中需根据情况被覆盖的变量值。</p>
<p>Kustomize 的主要价值是根据环境来生成不同的部署配置。只要建立多个 Kustomization 文件，开发人员就能以<a class="link"   target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/manage-kubernetes-objects/kustomization/" >基于基准进行派生<i class="fas fa-external-link-alt"></i></a>（Base and Overlay）的方式，对不同的模式（譬如生产模式、调试模式）、不同的项目（同一个产品对不同客户的客制化）定制出不同的资源整合包。在配置文件里，无论是开发关心的信息，还是运维关心的信息，只要是在元数据中有描述的内容，最初都是由开发人员来编写的，然后在编译期间由负责 CI/CD 的产品人员针对项目进行定制，最后在部署期间由运维人员通过 kubectl 的补丁（Patch）机制更改其中需要运维去关注的属性，譬如构造一个补丁来增加 Deployment 的副本个数，构造另外一个补丁来设置 Pod 的内存限制，等等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">k8s</span><br><span class="line"> ├── base</span><br><span class="line"> │     ├── deployment.yaml</span><br><span class="line"> │     ├── kustomization.yaml</span><br><span class="line"> │     └── service.yaml</span><br><span class="line"> └── overlays</span><br><span class="line">       └── prod</span><br><span class="line">       │     ├── load-loadbalancer-service.yaml</span><br><span class="line">       │     └── kustomization.yaml</span><br><span class="line">       └── debug</span><br><span class="line">             └── kustomization.yaml</span><br></pre></td></tr></table></figure>

<p>Kustomize 使用 Base、Overlay 和 Patch 生成最终配置文件的思路与 Docker 中分层镜像的思路有些相似，既规避了以“字符替换”对资源元数据文件的入侵，也不需要用户学习额外的 DSL 语法（譬如 Lua）。从效果来看，使用由 Kustomize 编译生成的 All-in-One 整合包来部署应用是相当方便的，只要一行命令就能够把应用涉及的所有服务一次安装好，本文档附带的<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/exploration/projects/microservice_arch_kubernetes.html" >Kubernetes 版本<i class="fas fa-external-link-alt"></i></a>和<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/exploration/projects/servicemesh_arch_istio.html" >Istio 版本<i class="fas fa-external-link-alt"></i></a>的 Fenix’s Booktstore 都使用了这种方式来发布应用的，你不妨实际体验一下。</p>
<p>但是毕竟 Kustomize 只是一个“小工具”性质的辅助功能，对于开发人员，Kustomize 只能简化产品针对不同情况的重复配置，其实并没有真正解决应用管理复杂的问题，要做的事、要写的配置，最终都没有减少，只是不用反复去写罢了；对于运维人员，应用维护不仅仅只是部署那一下，应用的整个生命周期，除了安装外还有更新、回滚、卸载、多版本、多实例、依赖项维护等诸多问题都很麻烦。这些问题需要更加强大的管理工具去解决，譬如下一节的主角 Helm。不过 Kustomize 能够以极小的成本，在一定程度上分离了开发和运维的工作，无需像 Helm 那样需要一套独立的体系来管理应用，这种轻量便捷，本身也是一种可贵的价值。</p>
<h3 id="Helm-与-Chart"><a href="#Helm-与-Chart" class="headerlink" title="Helm 与 Chart"></a>Helm 与 Chart</h3><p>另一种更具系统性的管理和封装应用的解决方案参考了各大 Linux 发行版管理应用的思路，代表为<a class="link"   target="_blank" rel="noopener" href="https://deis.com/" >Deis 公司<i class="fas fa-external-link-alt"></i></a>开发的<a class="link"   target="_blank" rel="noopener" href="https://helm.sh/" >Helm<i class="fas fa-external-link-alt"></i></a>和它的应用格式 Chart。Helm 一开始的目标就很明确：如果说 Kubernetes 是云原生操作系统的话，那 Helm 就要成为这个操作系统上面的应用商店与包管理工具。</p>
<p>Linux 下的包管理工具和封装格式，如 Debian 系的 apt-get 命令与 dpkg 格式、RHEL 系的 yum 命令与 rpm 格式相信大家肯定不陌生。有了包管理工具，你只要知道应用的名称，就可以很方便地从应用仓库中下载、安装、升级、部署、卸载、回滚程序，而且包管理工具自己掌握着应用的依赖信息和版本变更情况，具备完整的自管理能力，每个应用需要依赖哪些前置的第三方库，在安装的时候都会一并处理好。</p>
<p>Helm 模拟的就是上面这种做法，它提出了与 Linux 包管理直接对应的 Chart 格式和 Repository 应用仓库，针对 Kubernetes 中特有的一个应用经常要部署多个版本的特点，也提出了 Release 的专有概念。</p>
<p>Chart 用于封装 Kubernetes 应用涉及到的所有资源，通常以目录内的文件集合的形式存在。目录名称就是 Chart 的名称（没有版本信息），譬如官方仓库中 WordPress Chart 的目录结构是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">WordPress</span><br><span class="line"> ├── templates</span><br><span class="line"> │     ├── NOTES.txt</span><br><span class="line"> │     ├── deployment.yaml</span><br><span class="line"> │     ├── externaldb-secrets.yaml</span><br><span class="line"> │     └── 版面原因省略其他资源文件</span><br><span class="line"> │     └── ingress.yaml</span><br><span class="line"> └── Chart.yaml</span><br><span class="line"> └── requirements.yaml</span><br><span class="line"> └── values.yaml</span><br></pre></td></tr></table></figure>

<p>其中有几个固定的配置文件：<code>Chart.yaml</code>给出了应用自身的详细信息（名称、版本、许可证、自述、说明、图标，等等），<code>requirements.yaml</code>给出了应用的依赖关系，依赖项指向的是另一个应用的坐标（名称、版本、Repository 地址），<code>values.yaml</code>给出了所有可配置项目的预定义值。可配置项是指需要部署期间由运维人员调整的那些参数，它们以花括号包裹在<code>templates</code>目录下的资源文件中，部署应用时，Helm 会先将管理员设置的值覆盖到<code>values.yaml</code>的默认值上，然后以字符串替换的形式传递给<code>templates</code>目录的资源模版，最后生成要部署到 Kubernetes 的资源文件。由于 Chart 封装了足够丰富的信息，所以 Helm 除了支持命令行操作外，也能很容易地根据这些信息自动生成图形化的应用安装、参数设置界面。</p>
<p>Repository 仓库用于实现 Chart 的搜索与下载服务，Helm 社区维护了公开的 Stable 和 Incubator 的中央仓库（界面如下图所示），也支持其他人或组织搭建私有仓库和公共仓库，并能够通过 Hub 服务把不同个人或组织搭建的公共仓库聚合起来，形成更大型的分布式应用仓库，有利于 Chart 的查找与共享。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAGkCAMAAACWxmSsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6REJBRUVBRjFGNjMzMTFFQTk5N0NGQTE2QjZFQzU0MkMiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6REJBRUVBRjBGNjMzMTFFQTk5N0NGQTE2QjZFQzU0MkMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIwMjAgTWFjaW50b3NoIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Qzg0NzRENzk0NTE0MTFFQUE1OTdDN0U1MjAxRENBNDciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Qzg0NzREN0E0NTE0MTFFQUE1OTdDN0U1MjAxRENBNDciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz48vs4IAAABgFBMVEUbLEvz8/OY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" alt="Helm Hub 商店"></p>
<p>（图片来自<a class="link"   target="_blank" rel="noopener" href="https://helm.sh/" >Helm 官网<i class="fas fa-external-link-alt"></i></a>)</p>
<p>Helm 提供了应用全生命周期、版本、依赖项的管理能力，同时，Helm 还支持额外的扩展插件，能够加入 CI/CD 或者其他方面的辅助功能，这样的定位已经从单纯的工具升级到应用管理平台了。强大的功能让 Helm 受到了不少支持，有很多应用主动入驻到官方的仓库中。从 2018 年起，Helm 项目被托管到 CNCF，成为其中的一个孵化项目。</p>
<p>Helm 以模仿 Linux 包管理器的思路去管理 Kubernetes 应用，一定程度上是可行的，不过，Linux 与 Kubernetes 中部署应用还是存在一些差别，最重要的一点是在 Linux 中 99%的应用都只会安装一份，而 Kubernetes 里为了保证可用性，同一个应用部署多份副本才是常规操作。Helm 为了支持对同一个 Chart 包进行多次部署，每次安装应用都会产生一个版本（Release） ，版本相当于该 Chart 的安装实例。对于无状态的服务，Helm 靠着不同的版本就已经足够支持多个服务并行工作了，但对于有状态的服务来说，这些服务会与特定资源或者服务产生依赖关系，譬如要部署数据库，通常要依赖特定的存储来保存持久化数据，这样事情就变得复杂起来。Helm 无法很好地管理这种有状态的依赖关系，这一类问题就是 Operator 要解决的痛点了。</p>
<h2 id="Operator-与-CRD"><a href="#Operator-与-CRD" class="headerlink" title="Operator 与 CRD"></a>Operator 与 CRD</h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.redhat.com/zh/topics/containers/what-is-a-kubernetes-operator" >Operator<i class="fas fa-external-link-alt"></i></a>不应当被称作是一种工具或者系统，它应该算是一种封装、部署和管理 Kubernetes 应用的方法，尤其是针对最复杂的有状态应用去封装运维能力的解决方案，最早由 CoreOS 公司（于 2018 年被 RedHat 收购）的华人程序员邓洪超所提出。</p>
<p>如果上一节“<a class="link"   target="_blank" rel="noopener" href="http://icyfenix.cn/immutable-infrastructure/container/container-build-system.html" >以容器构建系统<i class="fas fa-external-link-alt"></i></a>”介绍 Kubernetes 资源与控制器模式时你没有开小差的话，那么 Operator 中最核心的理念你其实就已经理解得差不多了。简单地说，Operator 是通过 Kubernetes 1.7 开始支持的自定义资源（Custom Resource Definitions，CRD，此前曾经以 TPR，即 Third Party Resource 的形式提供过类似的能力），把应用封装为另一种更高层次的资源，再把 Kubernetes 的控制器模式从面向于内置资源，扩展到了面向所有自定义资源，以此来完成对复杂应用的管理。下面是笔者引用了一段 RedHat 官方对 Operator 设计理念的阐述：</p>
<blockquote>
<h4 id="Operator-设计理念"><a href="#Operator-设计理念" class="headerlink" title="Operator 设计理念"></a>Operator 设计理念</h4><p>Operator 是使用自定义资源（CR，笔者注：CR 即 Custom Resource，是 CRD 的实例）管理应用及其组件的自定义 Kubernetes 控制器。高级配置和设置由用户在 CR 中提供。Kubernetes Operator 基于嵌入在 Operator 逻辑中的最佳实践将高级指令转换为低级操作。Kubernetes Operator 监视 CR 类型并采取特定于应用的操作，确保当前状态与该资源的理想状态相符。</p>
<p>​                                                                                                                                                   —— <a class="link"   target="_blank" rel="noopener" href="https://www.redhat.com/zh/topics/containers/what-is-a-kubernetes-operator" >什么是 Kubernetes Operator<i class="fas fa-external-link-alt"></i></a>，RedHat</p>
</blockquote>
<p>以上这段文字不是笔者转述，而是直接由 RedHat 官方撰写和翻译成中文的，准确严谨但比较拗口，对于没接触过 Operator 的人并不友好，什么叫作“高级指令”？什么叫作“低级操作”？两者之间具体如何转换？为了能够理解这些问题，我们需要先弄清楚有状态和无状态应用的含义及影响，然后再来理解 Operator 所做的工作。</p>
<p>有状态应用（Stateful Application）与无状态应用（Stateless Application）说的是应用程序是否要自己持有其运行所需的数据，如果程序每次运行都跟首次运行一样，不会依赖之前任何操作所遗留下来的痕迹，那它就是无状态的；反之，如果程序推倒重来之后，用户能察觉到该应用已经发生变化，那它就是有状态的。无状态应用在分布式系统中具有非常巨大的价值，我们都知道分布式中的 CAP 不兼容原理，如果无状态，那就不必考虑状态一致性，没有了 C，那 A 和 P 便可以兼得，换而言之，只要资源足够，无状态应用天生就是高可用的。但不幸的是现在的分布式系统中多数关键的基础服务都是有状态的，如缓存、数据库、对象存储、消息队列，等等，只有 Web 服务器这类服务属于无状态。</p>
<p>站在 Kubernetes 的角度看，是否有状态的本质差异在于有状态应用会对某些外部资源有绑定性的直接依赖，譬如 Elasticsearch 建立实例时必须依赖特定的存储位置，重启后仍然指向同一个数据文件的实例才能被认为是相同的实例。另外，有状态应用的多个应用实例之间往往有着特定的拓扑关系与顺序关系，譬如 Etcd 的节点间选主和投票，节点们都需要得知彼此的存在。为了管理好那些与应用实例密切相关的状态信息，Kubernetes 从 1.9 版本开始正式发布了 StatefulSet 及对应的 StatefulSetController。与普通 ReplicaSet 中的 Pod 相比，由 StatefulSet 管理的 Pod 具备以下几项额外特性：</p>
<ul>
<li><strong>Pod 会按顺序创建和按顺序销毁</strong>：StatefulSet 中的各个 Pod 会按顺序地创建出来，创建后续的 Pod 前，必须要保证前面的 Pod 已经转入就绪状态。删除 StatefulSet 中的 Pod 时会按照与创建顺序的逆序来执行。</li>
<li><strong>Pod 具有稳定的网络名称</strong>：Kubernetes 中的 Pod 都具有唯一的名称，在普通的副本集中这是靠随机字符产生的，而在 StatefulSet 中管理的 Pod，会以带有顺序的编号作为名称，且能够在重启后依然保持不变。。</li>
<li><strong>Pod 具有稳定的持久存储</strong>：StatefulSet 中的每个 Pod 都可以拥有自己独立的 PersistentVolumeClaim 资源。即使 Pod 被重新调度到其它节点上，它所拥有的持久磁盘也依然会被挂载到该 Pod，这点会在“容器持久化”中进一步介绍。</li>
</ul>
<p>只是罗列出特性，应该很难快速理解 StatefulSet 的设计意图，笔者打个比方来帮助你理解：如果把 ReplicaSet 中的 Pod 比喻为养殖场中的“肉猪”，那 StatefulSet 就是被家庭当宠物圈养的“荷兰猪”，不同的肉猪在食用功能上并没有什么区别，但每只宠物猪都是独一无二的，有专属于自己的名字、习性与记忆，事实上，早期的 StatefulSet 就曾经有一段时间用过 PetSet 这个名字。</p>
<p>当 StatefulSet 出现以后，Kubernetes 就能满足 Pod 重新创建后仍然保留上一次运行状态的需求，不过有状态应用的维护并不仅限于此，譬如对于一套 Elasticsearch 集群来说，通过 StatefulSet 最多只能做到创建集群、删除集群、扩容缩容等最基本的操作，其他的运维操作，譬如备份和恢复数据、创建和删除索引、调整平衡策略等操作也十分常用，但是 StatefulSet 并不能为此提供任何帮助。</p>
<p>笔者再举个实际例子来说明 Operator 是如何解决那些 StatefulSet 覆盖不到的有状态服务管理需求的：假设要部署一套 Elasticsearch 集群，通常要在 StatefulSet 中定义相当多的细节，譬如服务的端口、Elasticsearch 的配置、更新策略、内存大小、虚拟机参数、环境变量、数据文件位置，等等，为了便于你对已经反复提及的 Kubernetes 的复杂有更加直观的体验，这里就奢侈一次，挥霍一次版面，将满足这个需求的 YAML 全文贴出如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">elasticsearch-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">es-cluster</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">transport</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9300</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">elasticsearch-loadbalancer</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">es-cluster</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9200</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">es-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">elasticsearch.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    cluster.name: my-elastic-cluster</span></span><br><span class="line"><span class="string">    network.host: &quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="string">    bootstrap.memory_lock: false</span></span><br><span class="line"><span class="string">    discovery.zen.ping.unicast.hosts: elasticsearch-cluster</span></span><br><span class="line"><span class="string">    discovery.zen.minimum_master_nodes: 1</span></span><br><span class="line"><span class="string">    xpack.security.enabled: false</span></span><br><span class="line"><span class="string">    xpack.monitoring.enabled: false</span></span><br><span class="line"><span class="string"></span>  <span class="attr">ES_JAVA_OPTS:</span> <span class="string">-Xms512m</span> <span class="string">-Xmx512m</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">esnode</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">es-cluster</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-sysctl</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sysctl&quot;</span>, <span class="string">&quot;-w&quot;</span>, <span class="string">&quot;vm.max_map_count=262144&quot;</span>]</span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">                <span class="attr">memory:</span> <span class="string">1Gi</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">add:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">IPC_LOCK</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">SYS_RESOURCE</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.9.1</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ES_JAVA_OPTS</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">es-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">ES_JAVA_OPTS</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/_cluster/health?local=true</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9200</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9200</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">es-http</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9300</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">es-transport</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">es-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch-config</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">elasticsearch.yml</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">es-config</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">elasticsearch.yml</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">elasticsearch.yml</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">es-data</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">5Gi</span></span><br></pre></td></tr></table></figure>

<p>出现如此大量的细节配置，其根本原因在于 Kubernetes 完全不知道 Elasticsearch 是个什么东西，所有 Kubernetes 不知道的信息、不能启发式推断出来的信息，都必须由用户在资源的元数据定义中明确列出，必须一步一步手把手地“教会”Kubernetes 如何部署 Elasticsearch，这种形式就属于 RedHat 在 Operator 设计理念介绍中所说的“低级操作”。</p>
<p>如果我们使用<a class="link"   target="_blank" rel="noopener" href="https://github.com/elastic/cloud-on-k8s" >Elastic.co 官方提供的 Operator<i class="fas fa-external-link-alt"></i></a>，那情况就会简单得多了，Elasticsearch Operator 提供了一种<code>kind: Elasticsearch</code>的自定义资源，在它的帮助下，仅需十行代码，将用户的意图是“部署三个版本为 7.9.1 的 ES 集群节点”说清楚即可，便能实现与前面 StatefulSet 那一大堆配置相同乃至更强大的效果，如下面代码所示。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">elasticsearch.k8s.elastic.co/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Elasticsearch</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">elasticsearch-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">7.9</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">nodeSets:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">count:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">node.ingest:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">node.store.allow_mmap:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>有了 Elasticsearch Operator 的自定义资源，相当于 Kubernetes 已经学会怎样操作了 Elasticsearch，知道所有它相关的参数含义与默认值，无需用户再手把手地教了，这种就是所谓的“高级指令”。</p>
<p>Operator 将简洁的高级指令转化为 Kubernetes 中具体操作的方法，与前面 Helm 或者 Kustomize 的思路并不相同。Helm 和 Kustomize 最终仍然是依靠 Kubernetes 的内置资源来跟 Kubernetes 打交道的，Operator 则是要求开发者自己实现一个专门针对该自定义资源的控制器，在控制器中维护自定义资源的期望状态。通过程序编码来扩展 Kubernetes，比只通过内置资源来与 Kubernetes 打交道要灵活得多，譬如当需要更新集群中某个 Pod 对象的时候，由 Operator 开发者自己编码实现的控制器完全可以在原地对 Pod 进行重启，而无需像 Deployment 那样必须先删除旧 Pod，然后再创建新 Pod。</p>
<p>使用 CRD 定义高层次资源、使用配套的控制器来维护期望状态，带来的好处不仅仅是“高级指令”的便捷，而是遵循 Kubernetes 一贯基于资源与控制器的设计原则的同时，又不必再受制于 Kubernetes 内置资源的表达能力。只要 Operator 的开发者愿意编写代码，前面曾经提到那些 StatfulSet 不能支持的能力，如备份恢复数据、创建删除索引、调整平衡策略等操作，都完全可以实现出来。</p>
<p>把运维的操作封装在程序代码上，表面看最大的受益者是运维人员，开发人员要为此付出更多劳动。然而 Operator 并没有受到开发人员的抵制，让它变得小众，反而由于代码相对于资源配置的表达能力提升，让开发与运维之间的协作成本降低而备受开发者的好评。Operator 变成了近两、三年容器封装应用的一股新潮流，现在很多复杂分布式系统都有了官方或者第三方提供的 Operator（<a class="link"   target="_blank" rel="noopener" href="https://github.com/operator-framework/awesome-operators" >这里收集了一部分<i class="fas fa-external-link-alt"></i></a>）。RedHat 公司也持续在 Operator 上面大量投入，推出了简化开发人员编写 Operator 的<a class="link"   target="_blank" rel="noopener" href="https://github.com/operator-framework/operator-sdk" >Operator Framework/SDK<i class="fas fa-external-link-alt"></i></a>。</p>
<p>目前看来，应对有状态应用的封装运维，Operator 也许是最有可行性的方案，但这依然不是一项轻松的工作。以<a class="link"   target="_blank" rel="noopener" href="https://github.com/coreos/etcd-operator" >Etcd 的 Operator<i class="fas fa-external-link-alt"></i></a>为例，Etcd 本身不算什么特别复杂的应用，Operator 实现的功能看起来也相当基础，主要有创建集群、删除集群、扩容缩容、故障转移、滚动更新、备份恢复等功能，其代码就已经超过一万行了。现在开发 Operator 的确还是有着相对较高的门槛，通常由专业的平台开发者而非业务开发或者运维人员去完成，但是 Operator 符合技术潮流，顺应软件业界所提倡的 DevOps 一体化理念，等 Operator 的支持和生态进一步成熟之后，开发和运维都能从中受益，未来应该能成长为一种应用封装的主流形式。</p>
<h3 id="开放应用模型"><a href="#开放应用模型" class="headerlink" title="开放应用模型"></a>开放应用模型</h3><p>本节介绍的最后一种应用封装的方案，是阿里云和微软在 2019 年 10 月上海 QCon 大会上联合发布的<a class="link"   target="_blank" rel="noopener" href="https://oam.dev/" >开放应用模型<i class="fas fa-external-link-alt"></i></a>（Open Application Model，OAM），它不仅是中国云计算企业参与制定乃至主导发起的国际技术规范，也是业界首个云原生应用标准定义与架构模型。</p>
<p>开放应用模型思想的核心是如何将开发人员、运维人员与平台人员关注点分离，开发人员关注业务逻辑的实现，运维人员关注程序平稳运行，平台人员关注基础设施的能力与稳定性，长期让几个角色厮混在同一个 All-in-One 资源文件里，并不能擦出什么火花，反而将配置工作弄得越来越复杂，将“<a class="link"   target="_blank" rel="noopener" href="https://www.stackery.io/blog/stop-yaml-engineering/" >YAML Engineer<i class="fas fa-external-link-alt"></i></a>”弄成了容器界的嘲讽梗。</p>
<p>开放应用模型把云原生应用定义为“由一组相互关联但又离散独立的组件构成，这些组件实例化在合适的运行时上，由配置来控制行为并共同协作提供统一的功能”。没看明白定义并没有关系，为了便于跟稍后的概念对应，笔者首先把这句话拆解、翻译为你更加看<strong>不</strong>明白的另一种形式：</p>
<p>OAM 定义的应用</p>
<p>一个<code>Application</code>由一组<code>Components</code>构成，每个<code>Component</code>的运行状态由<code>Workload</code>描述，每个<code>Component</code>可以施加<code>Traits</code>来获取额外的运维能力，同时我们可以使用<code>Application Scopes</code>将<code>Components</code>划分到一或者多个应用边界中，便于统一做配置、限制、管理。把<code>Components</code>、<code>Traits</code>和<code>Scopes</code>组合在一起实例化部署，形成具体的<code>Application Configuration</code>，以便解决应用的多实例部署与升级。</p>
<p>然后，笔者通过解析上述所列的核心概念来帮助你理解 OAM 对应用的定义。这段话里面每一个用英文标注出来的技术名词都是 OAM 在 Kubernetes 基础上扩展而来概念，每一个名词都有专门的自定义资源与之对应，换而言之，它们并非纯粹的抽象概念，而是可以被实际使用的自定义资源。这些概念的具体含义是：</p>
<ul>
<li><p><strong>服务组件</strong>（Components）：由 Component 构成应用的思想自 SOA 以来就屡见不鲜，然而 OAM 的 Component 不仅仅是特指构成应用“整体”的一个“部分”，它还有一个重要职责是抽象那些应该由开发人员去关注的元素。譬如应用的名字、自述、容器镜像、运行所需的参数，等等。</p>
</li>
<li><p><strong>工作负荷</strong>（Workload）：Workload 决定了应用的运行模式，每个 Component 都要设定自己的 Workload 类型，OAM 按照“是否可访问、是否可复制、是否长期运行”预定义了六种 Workload 类型，如表 11-2 所示。如有必要还可以通过 CRD 与 Operator 去扩展。</p>
<p>表 11-2 OAM 的六种工作负荷</p>
<table>
<thead>
<tr>
<th>工作负荷</th>
<th align="center">可访问</th>
<th align="center">可复制</th>
<th align="center">长期运行</th>
</tr>
</thead>
<tbody><tr>
<td>Server</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>Singleton Server</td>
<td align="center">√</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td>Worker</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>Singleton Worker</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td>Task</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">×</td>
</tr>
<tr>
<td>Singleton Task</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
</tr>
</tbody></table>
</li>
<li><p><strong>运维特征</strong>（Traits）：开发活动有大量复用功能的技巧，但运维活动却很贫乏，平时能为运维写个 Shell 脚本或者简单工具已经算是个高级的运维人员了。OAM 的 Traits 就用于封装模块化后的运维能力，可以针对运维中的可重复操作预先设定好一些具体的 Traits，譬如日志收集 Trait、负载均衡 Trait、水平扩缩容 Trait，等等。 这些预定义的 Traits 定义里，会注明它们可以作用于哪种类型的工作负荷、包含能填哪些参数、哪些必填选填项、参数的作用描述是什么，等等。</p>
</li>
<li><p><strong>应用边界</strong>（Application Scopes）：多个 Component 共同组成一个 Scope，你可以根据 Component 的特性或者作用域来划分 Scope，譬如具有相同网络策略的 Component 放在同一个 Scope 中，具有相同健康度量策略的 Component 放到另一个 Scope 中。同时，一个 Component 也可能属于多个 Scope，譬如一个 Component 完全可能既需要配置网络策略，也需要配置健康度量策略。</p>
</li>
<li><p><strong>应用配置</strong>（Application Configuration）：将 Component（必须）、Trait（必须）、Scope（非必须）组合到一起进行实例化，就形成了一个完整的应用配置。</p>
</li>
</ul>
<p>OAM 使用上述介绍的这些自定义资源将原先 All-in-One 的复杂配置做了一定层次的解耦，开发人员负责管理 Component；运维人员将 Component 组合并绑定 Trait 变成 Application Configuration；平台人员或基础设施提供方负责提供 OAM 的解释能力，将这些自定义资源映射到实际的基础设施。不同角色分工协作，整体简化了单个角色关注的内容，使得不同角色可以更聚焦更专业的做好本角色的工作，整个过程如图 11-8 所示。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAt0AAAG0CAMAAADZ+mvPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4N0U4MjExMUY2NjIxMUVBODRBRkVFNjIwNDg1RTZEMiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4N0U4MjExMkY2NjIxMUVBODRBRkVFNjIwNDg1RTZEMiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjg3RTgyMTBGRjY2MjExRUE4NEFGRUU2MjA0ODVFNkQyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjg3RTgyMTEwRjY2MjExRUE4NEFGRUU2MjA0ODVFNkQyIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+7KEM5QAAAYBQTFRFAXjU/f39c3Nz4eHhpMnr2trazMzM/7kBp6env7+/8fHx6enp5eXl1dXV+vr6lLntTU5OmJiYZeX82DsB2ef4HaXV/t+R9PT09/f3+Pj43t7eOzw9AaYBfX19Bp6iwsLCAgIC7+/vwtnzNrG1srOz/s9dTILw5lQs7OzsJDpefKvqQYnb/uu+6PL67ZR6/bwr4u36bpnx766Y6npcMERk9s3AM8rv9Pj9Vp3raXOAoQEujpqsZcPI/vLWSlt2NGvqZwIenJ2d/fHrCXkJ/vnt6ABDgbwF7vf6+vz9n6m4xsvU+NzT0M+PYGFh9/r9qs5S4+bqh4eIpiVKz9LYXZjdmnOWPapZdISboFpurq6uyMjItra2//v28vjjurq65+fnxcXFvuvwJicnA0ID+fn5/vz7ExMT4urxcykv4+Pj3+Ln7e3t29vb9fX19vb28/Pz6+vr1dng+fr67u7u19fX2NjYkZGR8vP1z8/PeDtNbsGHoaGi8vLyKnjU////////u/h1YwAAAIB0Uk5T/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wA4BUtnAABMRUlEQVR42uydi2PixrXwI/GIEAJESpeHPtWCZR1ir7N2Xt5N9hHS9K7TrXxL6/ulQC7GKquW8rzFJnwXrfjXvzMjiYcNGGyBecxZjKQZaTQ7+nF05szrox6RmxL76efXX3312VevX//8U2zrS6P09edffvobkE+//Pzr0jrl/COC8nX583evPxuW19/9eZuL4+svfzMiX35N6F5b+dfPn92Un/+1tWx/+psb8unXhO71fAl/99Vn4+Sr70rbWBw/fPmbsfLlD4TuNVTcrz+bJK+3UH2PU9xrpb4J3UPyx68+myxf/XHbiuOL30yRLwjd6yWez6aLh8C9ZngTugea+7Pb5I8E7vXCm9Ddt7mvmSWvf/rjXwujDpSvJtne/uiNIIq/7HXqY84dG7iCNvc1Q/uLr999ca2OOdH2rlM3gnbkXqMz5tSxgYRu270l1yqU31E6kv8ZCX493nPiV6XGjScseWISc8308fV6NwJX1FsyWqH83CiNdyOh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" alt="OAM 角色关系图"></p>
<p>（图片来自<a class="link"   target="_blank" rel="noopener" href="https://github.com/oam-dev/spec/" >OAM 规范 GitHub<i class="fas fa-external-link-alt"></i></a>)</p>
<p>OAM 未来能否成功，很大程度上取决于云计算厂商的支持力度，因为 OAM 的自定义资源一般是由云计算基础设施负责解释和驱动的，譬如阿里云的<a class="link"   target="_blank" rel="noopener" href="https://help.aliyun.com/product/29500.html" >EDAS<i class="fas fa-external-link-alt"></i></a>就已内置了 OAM 的支持。如果你希望能够应用于私有 Kubernetes 环境，目前 OAM 的主要参考实现是<a class="link"   target="_blank" rel="noopener" href="https://github.com/oam-dev/rudr" >Rudr<i class="fas fa-external-link-alt"></i></a>（已声明废弃）和<a class="link"   target="_blank" rel="noopener" href="https://crossplane.io/" >Crossplane<i class="fas fa-external-link-alt"></i></a>，Crossplane 是一个仅发起一年多的 CNCF 沙箱项目，主要参与者包括阿里云、微软、Google、RedHat 等工程师。Crossplane 提供了 OAM 中全部的自定义资源以及控制器，安装后便可用 OAM 定义的资源来描述应用。</p>
<hr>
<p><strong>后记</strong>：今天容器圈的发展是一日千里，各种新规范、新技术层出不穷，本节根据人气和代表性，列举了其中最出名的四种，其他笔者未提到的应用封装技术还有<a class="link"   target="_blank" rel="noopener" href="https://cnab.io/" >CNAB<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://github.com/airshipit/armada" >Armada<i class="fas fa-external-link-alt"></i></a>、<a class="link"   target="_blank" rel="noopener" href="https://www.pulumi.com/" >Pulumi<i class="fas fa-external-link-alt"></i></a>等等。这些封装技术会有一定的重叠之处，但并非都是重复的轮子，实际应用时往往会联合其中多个工具一起使用。应该如何封装应用才是最佳的实践，目前尚且没有定论，但是以应用为中心的理念却已经成为明确的共识。</p>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/posts/37051/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">tcpdump 命令详解</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/posts/34368/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">不可变基础设施【从微服务到云原生】</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JD</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%B9%E5%99%A8%E7%9A%84%E5%B4%9B%E8%B5%B7"><span class="nav-text">一、容器的崛起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E6%96%87%E4%BB%B6%EF%BC%9Achroot"><span class="nav-text">隔离文件：chroot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E8%AE%BF%E9%97%AE%EF%BC%9Anamespaces"><span class="nav-text">隔离访问：namespaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E8%B5%84%E6%BA%90%EF%BC%9Acgroups"><span class="nav-text">隔离资源：cgroups</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E7%B3%BB%E7%BB%9F%EF%BC%9ALXC"><span class="nav-text">封装系统：LXC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%BA%94%E7%94%A8%EF%BC%9ADocker"><span class="nav-text">封装应用：Docker</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E9%9B%86%E7%BE%A4%EF%BC%9AKubernetes"><span class="nav-text">封装集群：Kubernetes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E4%BB%A5%E5%AE%B9%E5%99%A8%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F"><span class="nav-text">二、以容器构建系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E4%B8%8E%E5%8D%8F%E4%BD%9C"><span class="nav-text">隔离与协作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9F%A7%E6%80%A7%E4%B8%8E%E5%BC%B9%E6%80%A7"><span class="nav-text">韧性与弹性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5%E5%BA%94%E7%94%A8%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E5%B0%81%E8%A3%85"><span class="nav-text">以应用为中心的封装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kustomize"><span class="nav-text">Kustomize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm-%E4%B8%8E-Chart"><span class="nav-text">Helm 与 Chart</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Operator-%E4%B8%8E-CRD"><span class="nav-text">Operator 与 CRD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Operator-%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"><span class="nav-text">Operator 设计理念</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E6%94%BE%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="nav-text">开放应用模型</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
