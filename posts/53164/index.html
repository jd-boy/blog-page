<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="JD">
    
    <title>
        
            代理详解 |
        
        Bean You
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"jzcupid.cn","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/favicon.ico","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"莫听穿林打叶声，何妨吟啸且徐行。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"trigger":"auto","preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Bean You
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">代理详解</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">JD</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-12-08 21:06:08
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E7%9F%A5%E8%AF%86%E5%BA%93/">知识库</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="OSI七层网络模型"><a href="#OSI七层网络模型" class="headerlink" title="OSI七层网络模型"></a>OSI七层网络模型</h3><p><img src="http://qiniu.jzcupid.cn/blog/5f12753000013ad717830982.png" alt="OSI七层网络模型"></p>
<h3 id="TCP-IP-四层模型"><a href="#TCP-IP-四层模型" class="headerlink" title="TCP/IP 四层模型"></a>TCP/IP 四层模型</h3><p><img src="http://qiniu.jzcupid.cn/blog/5f12753900019eef17940995.png" alt="TCP/IP四层网络模型"></p>
<h2 id="一、代理是什么"><a href="#一、代理是什么" class="headerlink" title="一、代理是什么"></a>一、代理是什么</h2><p>代理（英语：Proxy）也称网络代理，是一种特殊的网络服务，允许一个网络终端（一般为客户端）通过这个服务与另一个网络终端（一般为服务器）进行非直接的连接。一些网关、路由器等网络设备具备网络代理功能。一般认为代理服务有利于保障网络终端的隐私或安全，防止攻击。</p>
<h2 id="二、正向代理与反向代理"><a href="#二、正向代理与反向代理" class="headerlink" title="二、正向代理与反向代理"></a>二、正向代理与反向代理</h2><p>本质上来讲，代理都是存在于Client与Server之间的，但由于性质不同分为了两种。</p>
<h4 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h4><p>假设A、B、C三个人之间存在借钱的关系。</p>
<p><strong>正向代理：</strong></p>
<ol>
<li>A需要钱，A知道C有很多钱，想向C借钱</li>
<li>但是A和C有矛盾，于是A想通过B去借C的钱</li>
<li>B向C借到了钱，C不知道A的存在</li>
<li>最终B帮助A借到了C的钱</li>
</ol>
<p>这个过程中，B充当了代理的角色，代替A找C借钱，C对A是无感知的，这是正向代理。</p>
<p>其中A是Client，C是Server。</p>
<p>比如说翻墙，我们就是Client，通过代理，访问到了Google。</p>
<p><strong>反向代理：</strong></p>
<ol>
<li>A需要钱，C有很多钱，但A不知道C有很多钱</li>
<li>A找B借钱</li>
<li>B知道C有很多钱</li>
<li>B向C借钱，并把从C借到的钱给了A</li>
<li>A不知道C的存在，以为钱是B的</li>
</ol>
<p>这个过程中，B充当了代理借钱借钱的角色，不过不是替A借的，而是找C借钱然后给A了，换言之就是代替C将钱借给了A，同时A和C相互无感知，这就是反向代理。</p>
<p>其中A还是Client，C是Server。</p>
<p>比如Nginx的代理就是反向代理。</p>
<h3 id="安全模型不同"><a href="#安全模型不同" class="headerlink" title="安全模型不同"></a>安全模型不同</h3><ul>
<li>正向代理允许客户端通过它访问任意网站并且隐藏客户端自身，因此必须采取安全措施以确保仅为授权的客户端提供服务</li>
<li>反向代理都对外都是透明的，访问者并不知道自己访问的是代理，访问者不知道服务节点的存在，认为处理请求的就是代理节点</li>
</ul>
<p>总而言之，正向代理是从客户端的角度出发，服务于局域网用户，以访问非特定的服务，其中最典型的例子就是翻墙。</p>
<p>反向代理正好与此相反，从服务端的角度出发，服务于所有用户，隐藏实际的服务节点，服务节点的架构对用户透明，以代理节点统一对外服务。</p>
<h2 id="三、四层代理"><a href="#三、四层代理" class="headerlink" title="三、四层代理"></a>三、四层代理</h2><p>如果说网络层通信的粒度是物理终端设备的话，IP 就是标识不同物理设备的标识符。</p>
<p>那么传输层通信的粒度就是进程，端口就是标识不同进程的标识符。</p>
<p>四层代理的四层就是OSI七层网络模型中的 <strong>传输层</strong>。</p>
<p>四层代理是基于 <strong>IP + 端口</strong> 做的代理。通过 <strong>虚拟IP + 端口</strong> 接收请求，然后再分配到真实的服务器。</p>
<h4 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h4><p>以常见的TCP为例，从三次握手的第一次握手开始，代理设备在接收到第一个来自客户端的 SYN 请求时，即按照一定的策略选择一个被代理的后端服务器，并对报文中的 <strong>目标IP地址</strong> 进行修改（改为后端服务器IP），直接转发给该服务器。</p>
<p>TCP 连接建立，即三次握手，实际上是客户端和后端服务器建立的，代理设备只是起到一个类似路由器的转发动作。</p>
<p>在某些部署情况下，为保证服务器回包可以正确返回给负载均衡设备，在转发报文的同时可能还会对报文原来的原地址进行修改。</p>
<h4 id="凤凰架构中对四层代理的描述"><a href="#凤凰架构中对四层代理的描述" class="headerlink" title="凤凰架构中对四层代理的描述"></a>凤凰架构中对四层代理的描述</h4><p>现在所说的 “四层负载均衡” 其实是多种均衡器工作模式的统称，“四层”是说这些工作模式的共同特点是维持同一个 TCP 连接，而不是说它只工作在第四层。</p>
<p>事实上，这些模式主要都工作在第二层（数据链路层，改写 MAC 地址）和第三层（网络层，改写 IP 地址）上，单纯只处理第四层（传输层，可以改写 TCP、UDP 等协议的内容和端口）的数据无法做到负载均衡的转发，因为 OSI 的下三层是媒体层（Media Layer），上四层是主机层（Host Layer），既然流量都已经到达目标主机上了，也就谈不上什么流量转发，最多只能做代理。</p>
<h2 id="四、七层代理"><a href="#四、七层代理" class="headerlink" title="四、七层代理"></a>四、七层代理</h2><p>七层代理中的七层就是OSI七层网络模型中的 <strong>应用层</strong>。</p>
<p>七层代理是基于数据内容做的代理（应用层中的应用数据），最终的转发规则取决于内容的差异。</p>
<p>鉴于七层应用协议非常广泛，现在的七层代理主要是指 HTTP 代理。</p>
<h3 id="与四层代理的不同"><a href="#与四层代理的不同" class="headerlink" title="与四层代理的不同"></a>与四层代理的不同</h3><p>七层代理必须要先和代理设备三次握手后，才能得到七层（HTTP层）的具体内容，然后再转发。</p>
<p>也就是说 <strong>代理机必须要与客户端和后端服务器的机器都要建立连接</strong>。</p>
<p>显然，七层代理对代理设备的性能要求要高于四层代理。</p>
<h3 id="七层代理的好处"><a href="#七层代理的好处" class="headerlink" title="七层代理的好处"></a>七层代理的好处</h3><p>平常使用的Nginx，用作代理服务器的时候一般都是工作在第七层的。使用Nginx，我们可以代理静态文件、ajax后台接口、CDN重定向等，都是在传输层之上理解内容后做的工作。</p>
<h4 id="（1）使整个网络更智能化"><a href="#（1）使整个网络更智能化" class="headerlink" title="（1）使整个网络更智能化"></a>（1）使整个网络更智能化</h4><p>例如访问一个网站的用户流量，可以通过七层的方式，将对图片类的请求转发到特定的图片服务器并可以使用缓存技术；</p>
<p>将对文字类的请求可以转发到特定的文字服务器并可以使用压缩技术。</p>
<p>当然这只是七层应用的一个小案例，从技术原理上，这种方式可以对客户端的请求和服务器的响应进行任意意义上的修改，极大的提升了应用系统在网络层的灵活性。</p>
<p>很多在后台，例如Nginx或者Apache上部署的功能可以前移到负载均衡设备上，例如客户请求中的Header重写，服务器响应中的关键字过滤或者内容插入等功能。</p>
<h4 id="（2）安全性"><a href="#（2）安全性" class="headerlink" title="（2）安全性"></a>（2）安全性</h4><p>网络中最常见的SYN Flood攻击，即黑客控制众多源客户端，使用虚假IP地址对同一目标发送SYN攻击。</p>
<p>通常这种攻击会大量发送SYN报文，耗尽服务器上的相关资源，以达到Denial of Service(DoS)的目的。</p>
<p>从技术原理上也可以看出，四层模式下这些SYN攻击都会被转发到后端的服务器上。</p>
<p>而七层模式下这些SYN攻击自然在负载均衡设备上就截止，不会影响后台服务器的正常运营。</p>
<p>另外负载均衡设备可以在七层层面设定多种策略，过滤特定报文，例如SQL Injection等应用层面的特定攻击手段，从应用层面进一步提高系统整体安全。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>现在的七层代理，主要还是着重于应用HTTP协议，所以其应用范围主要是众多的网站或者内部信息平台等基于B/S开发的系统。</p>
<p>四层代理则对应其他TCP应用，例如基于C/S开发的系统。</p>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/posts/42351/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">最大QPS推算</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/posts/22705/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Mac 安装 Minikube</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JD</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="nav-text">OSI七层网络模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP-%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="nav-text">TCP&#x2F;IP 四层模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BB%A3%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">一、代理是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-text">二、正向代理与反向代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="nav-text">举个例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%E4%B8%8D%E5%90%8C"><span class="nav-text">安全模型不同</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%9B%9B%E5%B1%82%E4%BB%A3%E7%90%86"><span class="nav-text">三、四层代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BE%E4%B8%AA%E6%A0%97%E5%AD%90"><span class="nav-text">举个栗子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%A4%E5%87%B0%E6%9E%B6%E6%9E%84%E4%B8%AD%E5%AF%B9%E5%9B%9B%E5%B1%82%E4%BB%A3%E7%90%86%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="nav-text">凤凰架构中对四层代理的描述</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E4%B8%83%E5%B1%82%E4%BB%A3%E7%90%86"><span class="nav-text">四、七层代理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E%E5%9B%9B%E5%B1%82%E4%BB%A3%E7%90%86%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="nav-text">与四层代理的不同</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83%E5%B1%82%E4%BB%A3%E7%90%86%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="nav-text">七层代理的好处</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E4%BD%BF%E6%95%B4%E4%B8%AA%E7%BD%91%E7%BB%9C%E6%9B%B4%E6%99%BA%E8%83%BD%E5%8C%96"><span class="nav-text">（1）使整个网络更智能化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-text">（2）安全性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-text">小结</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
