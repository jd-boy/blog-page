<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="JD">
    
    <title>
        
            最大QPS推算 |
        
        Bean You
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"jzcupid.cn","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico","favicon":"http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"莫听穿林打叶声，何妨吟啸且徐行。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"trigger":"auto","preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Bean You
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">最大QPS推算</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="http://qiniu.jzcupid.cn/blog%E5%9B%BE%E6%A0%87.ico">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">JD</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-12-09 10:52:53
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E7%9F%A5%E8%AF%86%E5%BA%93/">知识库</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="一、RT"><a href="#一、RT" class="headerlink" title="一、RT"></a>一、RT</h2><p><strong>RT = ThreadCPUTime + ThreadWaitTime</strong></p>
<p>RT（Response Time）即响应时间。</p>
<p>可以理解为系统从输入到输出的时间间隔，系统是指一个网站或其他类型的软件应用，或者指某个设备，比如手机，手机界面也有响应时间。</p>
<p>所以RT是一个比较广泛的概念，不过本章探讨的RT都是特指互联网应用。</p>
<p><strong>服务器端RT</strong>：指从服务器接收请求到该请求响应的全部数据被发往客户端的时间</p>
<p><strong>客户端RT</strong>：从客户端（例如浏览器）发起请求到客户端接收到请求响应的全部数据的时间间隔。</p>
<p><strong>服务端RT + 网络开销 ≈ 客户端RT</strong></p>
<p>也就是说一个差的网络环境会导致两个RT差距悬殊，比如从国外到国内的RT远大于国内网络环境中的RT。</p>
<p>客户端的RT直接影响用户体验，要想降低客户端RT，需要考虑亮点：</p>
<ul>
<li>服务器端RT</li>
<li>网络</li>
</ul>
<p>对于网络来说，常见的优化方式有CDN、AND和专线，分别适用于不同的场景。</p>
<p>对于服务端的RT来说，主要看服务端的做法。</p>
<p>从上边的公式可以看出，要想降低 <strong>RT</strong>，可以通过降低 <strong>ThreadCPUTime</strong> 和 <strong>ThreadWaitTime</strong> 的方式。</p>
<p>后面将从 <strong>RT</strong>、<strong>ThreadCPUTime</strong> 和 <strong>ThreadWaitTime</strong> 来进行讨论。</p>
<h2 id="二、单线程QPS"><a href="#二、单线程QPS" class="headerlink" title="二、单线程QPS"></a>二、单线程QPS</h2><p>上一节中简单地定义了RT由 <strong>ThreadCPUTime</strong> 和 <strong>ThreadWaitTime</strong> 两部分组成。</p>
<p>如果系统里只有一个线程或者一个进程（该进程中只有一个线程），那么最大QPS是多少？</p>
<p>假设RT是199ms，其中ThreadCPUTime 为19ms，ThreadWaitTime 为 180ms，</p>
<p>那么1000ms内系统可以接收的最大请求数就是 <strong>1000ms/(19ms+180ms) ≈ 5.025</strong>。</p>
<p>所以单线程的 <strong>QPS = 1000ms / RT</strong></p>
<h2 id="三、最佳线程数"><a href="#三、最佳线程数" class="headerlink" title="三、最佳线程数"></a>三、最佳线程数</h2><p>还是上边的例子，假设CPU核数是1.</p>
<p>假设只有一个线程，这个线程在执行某个请求时，CPU真正花在该线程上的时间就是 ThreadCPUTime，即19ms。</p>
<p>那么在整个RT生命周期中，还有180ms的 ThreadWaitTime，这个时间CPU在做什么？</p>
<p>在理想情况下，抛开系统层面的问题，可以认为CPU在这180ms内什么都没做，至少对于业务来说什么都没做。</p>
<h3 id="1核的情况"><a href="#1核的情况" class="headerlink" title="1核的情况"></a>1核的情况</h3><p>由于每个请求的接收，CPU只需要工作19ms，所以在180ms的时间内，可以认为系统还可以额外接收 <strong>180ms/19ms ≈ 9</strong> 个请求。</p>
<p>由于在同步模型中，一个请求需要一个线程来处理，因此需要额外的9个线程来处理这些。</p>
<p>所以1核的最佳线程数就是：** (180ms + 19ms) / 19ms ≈ 10 **</p>
<p>多线程之后，ThreadCPUTime 从19ms变成了20ms，这1ms的差值表示多线程之后线程上下文切换、GC等带来的额外开销（JVM情况下），这里的1ms只是一个假设，可以把它看作n。</p>
<h3 id="2核的情况"><a href="#2核的情况" class="headerlink" title="2核的情况"></a>2核的情况</h3><p>1核的情况下可以有10个线程，在理想情况下，2核的最佳线程数可以认为：</p>
<p><strong>2 * (180ms + 20ms) / 20ms = 20</strong></p>
<h3 id="CPU利用率"><a href="#CPU利用率" class="headerlink" title="CPU利用率"></a>CPU利用率</h3><p>上面举的例子都是在 <strong>CPU满载</strong> 的情况下。</p>
<p>有时由于某个瓶颈，导致CPU得不到有效利用。比如2核的CPU，因为某个资源，各自职能使用一半的效能，这样总的CPU利用率就变成了 50%。</p>
<p>这种情况下，最佳线程数是：<strong>50% * 2 * (180ms + 20ms) / 20ms = 10</strong></p>
<h3 id="最佳线程数公式"><a href="#最佳线程数公式" class="headerlink" title="最佳线程数公式"></a>最佳线程数公式</h3><p>根据上面的分析，最佳线程数公式如下：<br><strong>最佳线程数 = (RT / ThreadCPUTime) * CPU核数 * CPU利用率</strong></p>
<p>当然，最佳线程数公式不是任意推测的，在一些权威著作上都有论述，所以接下来，假设最佳线程数的公式是正确的。</p>
<h2 id="四、最大QPS"><a href="#四、最大QPS" class="headerlink" title="四、最大QPS"></a>四、最大QPS</h2><h3 id="最大QPS公式推导"><a href="#最大QPS公式推导" class="headerlink" title="最大QPS公式推导"></a>最大QPS公式推导</h3><p>假设知道最佳线程数，也知道每个线程的QPS，那么线程数✖️每个线程的QPS，即这台机器在最佳线程数下的QPS。</p>
<p><img src="http://qiniu.jzcupid.cn/blog/rBAADF9xvbqAel4QAAHQY56KL5c258.png" alt="最大qps推导1"></p>
<p>把分子、分母去约数</p>
<p><img src="http://qiniu.jzcupid.cn/blog/rBAADF9xvb2AJXYGAAG9znnlWu0158.png" alt="最大qps推导2"></p>
<p>化简后得</p>
<p><img src="http://qiniu.jzcupid.cn/blog/rBAADF9xvb-ANsanAADB2zQOv7A619.png" alt="最大qps推导3"></p>
<p>从公式可可以看出，决定QPS的是 <strong>ThreadCPUTime</strong>、CPU核数、CPU利用率。</p>
<p>CPU核数师由硬件决定的，ThreadCPUTime 和 CPU利用率与我们的代码息息相关。</p>
<p>虽然宏观上是正确的，但是推导的过程还是由一点瑕疵，因为多线程下的 ThreadCPUTime （比如高并发下的GC次数增加、线程上下文切换等，导致ThreadCPUTime增加）和单线程的 ThreadCPUTime 是不一样的，所以导致推算出的结果存在误差。</p>
<h3 id="ThreadCPUTime"><a href="#ThreadCPUTime" class="headerlink" title="ThreadCPUTime"></a>ThreadCPUTime</h3><p>ThreadCPUTime 不只是业务逻辑所消耗的CPU时间，而是一次请求中所有环节上消耗的CPU时间之和。</p>
<p>比如，在web应用中，一个请求过来的HTTP的解析所消耗的CPU时间、这个请求中RPC调用的encode和decode所消耗的CPU时间，这些都是 ThreadCPUTime 的一部分。</p>
<p>所以影响 ThreadCPUTime 的因素有两个：</p>
<ol>
<li>数据结构</li>
<li>算法</li>
</ol>
<p>例如：Hash问题、排序与查找问题、状态机问题、序列化问题等。</p>
<h3 id="CPU利用率-1"><a href="#CPU利用率-1" class="headerlink" title="CPU利用率"></a>CPU利用率</h3><p>CUP利用率不高的情况是经常发生的，以下因素都会影响CPU利用率，从而影响系统可以支持的最大QPS。</p>
<h4 id="（1）IO能力"><a href="#（1）IO能力" class="headerlink" title="（1）IO能力"></a>（1）IO能力</h4><ul>
<li>磁盘IO</li>
<li>网络IO<ul>
<li>带宽：比如某大促压测时，由于某个应用放在Tair中的数据量大，导致Tair的机器网卡跑满</li>
<li>网络链路：还是大促，借用了其他核心交换机下的机器，导致客户端RT明显增加</li>
</ul>
</li>
</ul>
<h4 id="（2）数据库连接池"><a href="#（2）数据库连接池" class="headerlink" title="（2）数据库连接池"></a>（2）数据库连接池</h4><p>并发能力 = PoolWaitTime / RT(client) * PoolSize</p>
<h4 id="（3）内存不足"><a href="#（3）内存不足" class="headerlink" title="（3）内存不足"></a>（3）内存不足</h4><p>GC大量占用CPU，导致给业务逻辑使用的CPU利用率下降，而且GC时还满足Amdahl定律所定义的场景。</p>
<h4 id="（4）共享资源的竞争"><a href="#（4）共享资源的竞争" class="headerlink" title="（4）共享资源的竞争"></a>（4）共享资源的竞争</h4><p>比如各种锁策略（读写锁、锁分离等）、阻塞队列等。</p>
<h4 id="（5）依赖的服务"><a href="#（5）依赖的服务" class="headerlink" title="（5）依赖的服务"></a>（5）依赖的服务</h4><p>如RPC调用其他服务、DB等。</p>
<h4 id="（6）线程数或进程数，乃至编程模型（同步模型、异步模型，某些场景适合同步模型，某些适合异步模型）"><a href="#（6）线程数或进程数，乃至编程模型（同步模型、异步模型，某些场景适合同步模型，某些适合异步模型）" class="headerlink" title="（6）线程数或进程数，乃至编程模型（同步模型、异步模型，某些场景适合同步模型，某些适合异步模型）"></a>（6）线程数或进程数，乃至编程模型（同步模型、异步模型，某些场景适合同步模型，某些适合异步模型）</h4><p>在压测过程中，出现最多的是网络IO层面的问题、GC大量占用 ThreadCPUTime 之类的问题。</p>
<h3 id="CPU核数"><a href="#CPU核数" class="headerlink" title="CPU核数"></a>CPU核数</h3><h4 id="1-Amdahl定律（安达尔定律）"><a href="#1-Amdahl定律（安达尔定律）" class="headerlink" title="1.Amdahl定律（安达尔定律）"></a>1.Amdahl定律（安达尔定律）</h4><p>Amdahl定律是用来描述可伸缩性的。</p>
<p>可伸缩性指：当增加计算资源的时候，如CPU、内存、带宽等，QPS能够相应地进行改进。</p>
<p>Amdahl在论文中指出，可伸缩性是指在一个系统中，基于可并行化和串行化的组件各自所占的比例，当程序获得额外的计算资源（如CPU、内存等）时，系统理论上能够获得的加速值（QPS或者其他指标可以翻几倍）。</p>
<p>用公式来表示，如果F表示必须串行化执行的比例，那么在一个N核的CPU的机器中，</p>
<p><strong>加速比 = 1 / (F + (1 - F) / N)</strong></p>
<p>这个公式代表的意义比较广泛，在项目管理中有一句类似的话：</p>
<p>一个女人生一个孩子，需要9个月，但是永远不可能让9女人在一个月内就生一个孩子。</p>
<p>拿公式套用一下，这里F = 100%，9 个女人表示N = 9，于是就有 <strong>1 / (100% + (1 - 100%) / 9) = 1</strong>，所以加速比为1，等于没加速。</p>
<blockquote>
<p> 这里需要注意的是，这个公式描述的是，在增加资源的情况下系统的加速比，而不是在资源不变的情况下优化数据结构和算法之后带来的提升。</p>
<p>优化数据结构和算法带来的提升要看前文最大QPS公式。</p>
<p>不过这两个公式也不是完全没有联系，在增加资源的情况下，它们的联系还是比较紧密的。</p>
</blockquote>
<h4 id="2-Gustafson定律（古斯塔夫森定律）"><a href="#2-Gustafson定律（古斯塔夫森定律）" class="headerlink" title="2.Gustafson定律（古斯塔夫森定律）"></a>2.Gustafson定律（古斯塔夫森定律）</h4><p>该定律是对Amdahl定律的补充：<strong>S(P) = P - a * (P - 1)</strong></p>
<p>P是处理器核数，a是串行时间占总执行时间的比例。</p>
<p>上边的案例套用公式，P为女人个数9，串行比例100%。</p>
<p>Speedup = 9 - 100% * (9 - 1) = 1。</p>
<p>也就是无法加速。</p>
<p>这两个定律有关系吗？有，它们是相辅相成的。</p>
<p>前者从串行和并行执行时间的角度来推导，后者从串行和并行的计算量角度来推导，不管哪个角度，最终的结果是一样的。</p>
<h4 id="3-CPU核数与Amdahl定律关系"><a href="#3-CPU核数与Amdahl定律关系" class="headerlink" title="3.CPU核数与Amdahl定律关系"></a>3.CPU核数与Amdahl定律关系</h4><p>通过最大QPS公式，笔者发现，在CPU Time和CPU利用率不变的情况下，核数越多，QPS就越大。比如核数从1到4，在CPU Time和CPU利用率不变的情况下，加速比应该是4，所以QPS应该增加4倍。</p>
<p>这是资源增加（CPU核数增加）的情况下的加速比，也可以通过Amdahl定律来衡量，考虑串行和并行的比例在增加资源的情况下是否会改变。也就是要考虑在N增加的情况下，F受哪些因素的影响：</p>
<p>只要F大于0，最大QPS就不会翻4倍。</p>
<p>一个公式说要增加4倍，一个定理说没有4倍，互相矛盾？</p>
<p>其实事情是这样的，通过最大QPS公式，我们得知，如果 ThreadCPUTime 和CPU利用率不变，核数从1增加到4，QPS会相应地增加4倍。但是在实际情况下，当核数增加时，ThreadCPUTime 和CPU利用率大部分时候是变化的，所以前面的假设不成立，即一般场景下最大QPS不能增加4倍。</p>
<p>为什么增加计算资源时，最大QPS公式中的CPU Time和CPU利用率会变化，F也会变化呢？我们可以从宏观上分析一下，增加计算资源时，达到满载：</p>
<ul>
<li>QPS会更高，单位时间内产生的对象会更多。在同等条件下，minor GC被触发的次数增加，还有些场景发生过对象多到响应没返回它们就进了“老年代”，从而full GC被触发。宏观上，这是属于串行的部分，对于Amdahl公式来说F会受到影响，对于最大QPS公式来说，CPU Time和CPU利用率也受到影响。</li>
<li>在同步模型下大量的线程在完成一次请求中，上下文被切换的次数大大增加。</li>
<li>尤其是在有串行模块的时候，串行的执行和等待时间增加，F会变化，某些场景下CPU利用率也达不到理想效果，这取决于你的代码。这也是要做锁分离、为什么要缩小同步块的原因。当然还有锁自身的优化，比如偏向、自旋、读写分离等技术，都是为了不断地减少Amdahl定律中的F，也是为了减少ThreadCPUTime（锁本身的优化），提高CPU利用率（使用锁的方法的优化）。<ul>
<li>锁本身的优化最为津津乐道的是自旋、偏向、自适应，这些知识点请看网上的synchronized分析，还有reetrantLock的代码及AQS论文。</li>
<li>使用锁的优化方法最常见的是缩小锁区间、锁分离、无锁化、volatile。</li>
</ul>
</li>
</ul>
<p>所以在增加计算资源时，更高的并发产生，会引起最大QPS公式中两个参数的变化，也会引起Amdahl定律中F值的变化，同时公式和定律变化的趋势是相同的。Amdahl定律是得到广泛认可的，也是得到数据验证的。最大QPS公式好像没有人验证过，这里引用一个比较有名的测试结果。</p>
<p><img src="http://qiniu.jzcupid.cn/blog/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A120211209-141857.png" alt="企业微信20211209-141857"></p>
<p>从图中可以看出</p>
<ul>
<li>当计算资源（处理器数量）增加时，在串行部分比例不变的情况下，CPU利用率下降。</li>
<li>当计算资源（处理器数量）增加时，串行占的比例越大，CPU利用率下降得越多。</li>
</ul>
<p>原文连接：<a class="link"   target="_blank" rel="noopener" href="http://bjxiaoyu.com/newsde.html?id=77" >http://bjxiaoyu.com/newsde.html?id=77<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/posts/10118/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">I/O模型与单服务器高性能架构</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/posts/53164/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">代理详解</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JD</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81RT"><span class="nav-text">一、RT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%8D%95%E7%BA%BF%E7%A8%8BQPS"><span class="nav-text">二、单线程QPS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%9C%80%E4%BD%B3%E7%BA%BF%E7%A8%8B%E6%95%B0"><span class="nav-text">三、最佳线程数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E6%A0%B8%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">1核的情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E6%A0%B8%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">2核的情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU%E5%88%A9%E7%94%A8%E7%8E%87"><span class="nav-text">CPU利用率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E7%BA%BF%E7%A8%8B%E6%95%B0%E5%85%AC%E5%BC%8F"><span class="nav-text">最佳线程数公式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%9C%80%E5%A4%A7QPS"><span class="nav-text">四、最大QPS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E5%A4%A7QPS%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC"><span class="nav-text">最大QPS公式推导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ThreadCPUTime"><span class="nav-text">ThreadCPUTime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU%E5%88%A9%E7%94%A8%E7%8E%87-1"><span class="nav-text">CPU利用率</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89IO%E8%83%BD%E5%8A%9B"><span class="nav-text">（1）IO能力</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-text">（2）数据库连接池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3"><span class="nav-text">（3）内存不足</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%884%EF%BC%89%E5%85%B1%E4%BA%AB%E8%B5%84%E6%BA%90%E7%9A%84%E7%AB%9E%E4%BA%89"><span class="nav-text">（4）共享资源的竞争</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%885%EF%BC%89%E4%BE%9D%E8%B5%96%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="nav-text">（5）依赖的服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%886%EF%BC%89%E7%BA%BF%E7%A8%8B%E6%95%B0%E6%88%96%E8%BF%9B%E7%A8%8B%E6%95%B0%EF%BC%8C%E4%B9%83%E8%87%B3%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B%EF%BC%88%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%9E%8B%E3%80%81%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B%EF%BC%8C%E6%9F%90%E4%BA%9B%E5%9C%BA%E6%99%AF%E9%80%82%E5%90%88%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%9E%8B%EF%BC%8C%E6%9F%90%E4%BA%9B%E9%80%82%E5%90%88%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">（6）线程数或进程数，乃至编程模型（同步模型、异步模型，某些场景适合同步模型，某些适合异步模型）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU%E6%A0%B8%E6%95%B0"><span class="nav-text">CPU核数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Amdahl%E5%AE%9A%E5%BE%8B%EF%BC%88%E5%AE%89%E8%BE%BE%E5%B0%94%E5%AE%9A%E5%BE%8B%EF%BC%89"><span class="nav-text">1.Amdahl定律（安达尔定律）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Gustafson%E5%AE%9A%E5%BE%8B%EF%BC%88%E5%8F%A4%E6%96%AF%E5%A1%94%E5%A4%AB%E6%A3%AE%E5%AE%9A%E5%BE%8B%EF%BC%89"><span class="nav-text">2.Gustafson定律（古斯塔夫森定律）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-CPU%E6%A0%B8%E6%95%B0%E4%B8%8EAmdahl%E5%AE%9A%E5%BE%8B%E5%85%B3%E7%B3%BB"><span class="nav-text">3.CPU核数与Amdahl定律关系</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
