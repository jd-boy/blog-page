<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="JD">
    
    <title>
        
            Resilience4j |
        
        Bean You
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"jzcupid.cn","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/favicon.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"莫听穿林打叶声，何妨吟啸且徐行。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"trigger":"auto","preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Bean You
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Resilience4j</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">JD</span>
                        
                            <span class="author-label">Lv6</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2022-04-23 19:48:55
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%AE%9E%E7%94%A8%E7%B1%BB%E5%BA%93/">实用类库</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E9%99%90%E6%B5%81/">限流</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p><a class="link"   target="_blank" rel="noopener" href="https://resilience4j.readme.io/docs" >Resilience4j 官方文档<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="一、依赖"><a href="#一、依赖" class="headerlink" title="一、依赖"></a>一、依赖</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">implementation(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-aop&#x27;</span>)</span><br><span class="line">implementation(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-actuator&#x27;</span>)</span><br><span class="line">implementation(<span class="string">&quot;io.github.resilience4j:resilience4j-spring-boot2:$&#123;resilience4jVersion&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="二、CircuitBreaker"><a href="#二、CircuitBreaker" class="headerlink" title="二、CircuitBreaker"></a>二、CircuitBreaker</h2><p>CircuitBreaker 是通过三个正常状态（CLOSED、OPEN 和 HALF_OPEN）以及两个特殊状态（DISABLED 和 FORCED_OPEN） 的有限状态机实现的。</p>
<p><img src="https://files.readme.io/39cdd54-state_machine.jpg" alt="img"></p>
<p>CircuitBreaker 使用滑动窗口来存储和汇总调用结果。</p>
<p>支持基于计数的滑动窗口和基于时间的滑动窗口。基于计数的滑动窗口聚合最后 N 次调用的结果。基于时间的滑动窗口聚合了最后 N 秒的调用结果。</p>
<h3 id="失败率和慢调用率阈值"><a href="#失败率和慢调用率阈值" class="headerlink" title="失败率和慢调用率阈值"></a>失败率和慢调用率阈值</h3><p>当失败率大于或等于配置的阈值，CircuitBreaker 会从 CLOSED 状态变为 OPEN 状态。</p>
<p>默认所有异常都被视为失败。</p>
<p>可以定义应被视为失败的异常列表，然后其他所有的异常都被视为成功，除非它们被忽略。异常也可以被忽略，这样它们既不能算作失败也不能算成功。</p>
<p>当慢速调用的百分比等于或大于可配置的阈值时，CircuitBreaker 也会从 CLOSED 变为 OPEN。</p>
<p>只有记录了最少的调用次数，才能计算失败率和慢速调用率。例如，如果需要调用的最小数量为 10，则必须至少记录 10 个调用，然后才能计算失败率。</p>
<p>在 OPEN 状态下，CircuitBreaker 会拒绝调用并抛出 CallNotPermittedException 异常。</p>
<p>在等待时间一段时间后，CircuitBreaker 状态从 OPEN 变为 HALF _ OPEN，并允许可配置的调用数量，以查看后端是否仍然不可用或已重新可用。</p>
<p>在所有允许的调用完成之前，进一步的调用将被 CallNotPermittedException 拒绝。</p>
<p>如果失败率或慢调用率随后大于或等于配置的阈值，则状态将更改为 OPEN。如果失败率或慢调用率低于阈值，则状态将更改为 CLOSED 。</p>
<p>CircuitBreaker 支持另外两个特殊的状态，DISABLED (总是允许访问)和 FORCED_OPEN (总是拒绝访问)。在这两种状态下，不会产生任何断路器事件(除了状态转换) ，也不会记录任何指标。退出这些状态的唯一方法是触发状态转换或重置断路器。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><table>
<thead>
<tr>
<th align="left">Config property</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">failureRateThreshold</td>
<td align="left">50</td>
<td align="left">以百分比为单位配置故障率阈值。当故障率等于或大于阈值时，CircuitBreaker 转换为打开并开始短路调用。</td>
</tr>
<tr>
<td align="left">slowCallRateThreshold</td>
<td align="left">100</td>
<td align="left">以百分比为单位配置阈值。当调用持续时间大于 slowCallDurationThreshold 时，CircuitBreaker 认为调用是慢的，当慢调用的百分比等于或大于阈值时，CircuitBreaker 转换为打开并开始短路调用。</td>
</tr>
<tr>
<td align="left">slowCallDurationThreshold</td>
<td align="left">60000 [ms]</td>
<td align="left">持续时间高于该值的调用被视为慢调用，并提高慢调用率，即slowCallRateThreshold的值。</td>
</tr>
<tr>
<td align="left">permittedNumberOfCalls InHalfOpenState</td>
<td align="left">10</td>
<td align="left">断路器半开时允许的调用数。</td>
</tr>
<tr>
<td align="left">maxWaitDurationInHalfOpenState</td>
<td align="left">0 [ms]</td>
<td align="left">该等待时间控制 CircuitBreaker 在切换到 OPEN 状态之前可以保持 HALF_OPEN 状态的最长时间。值0意味着断路器将在 HALF_OPEN 状态下无限等待，直到所有允许的调用完成。</td>
</tr>
<tr>
<td align="left">slidingWindowType</td>
<td align="left">COUNT_BASED</td>
<td align="left">滑动窗口类型，可以是基于计数的或基于时间的。  如果滑动窗口是 COUNT_BASED，则记录并聚合最后的 slidingWindowSize 次调用。如果滑动窗口是 time_based，则记录并聚合最后一次 slidingWindowSize 秒的调用。</td>
</tr>
<tr>
<td align="left">slidingWindowSize</td>
<td align="left">100</td>
<td align="left">配置滑动窗口的大小，该窗口用于在关闭 CircuitBreaker 时记录调用的结果。</td>
</tr>
<tr>
<td align="left">minimumNumberOfCalls</td>
<td align="left">100</td>
<td align="left">Configures the minimum number of calls which are required (per sliding window period) before the CircuitBreaker can calculate the error rate or slow call rate. For example, if minimumNumberOfCalls is 10, then at least 10 calls must be recorded, before the failure rate can be calculated. If only 9 calls have been recorded the CircuitBreaker will not transition to open even if all 9 calls have failed.</td>
</tr>
<tr>
<td align="left">waitDurationInOpenState</td>
<td align="left">60000 [ms]</td>
<td align="left">The time that the CircuitBreaker should wait before transitioning from open to half-open.</td>
</tr>
<tr>
<td align="left">automaticTransition FromOpenToHalfOpenEnabled</td>
<td align="left">false</td>
<td align="left">If set to true it means that the CircuitBreaker will automatically transition from open to half-open state and no call is needed to trigger the transition. A thread is created to monitor all the instances of CircuitBreakers to transition them to HALF_OPEN once waitDurationInOpenState passes. Whereas, if set to false the transition to HALF_OPEN only happens if a call is made, even after waitDurationInOpenState is passed. The advantage here is no thread monitors the state of all CircuitBreakers.</td>
</tr>
<tr>
<td align="left">recordExceptions</td>
<td align="left">empty</td>
<td align="left">A list of exceptions that are recorded as a failure and thus increase the failure rate. Any exception matching or inheriting from one of the list counts as a failure, unless explicitly ignored via <code>ignoreExceptions</code>. If you specify a list of exceptions, all other exceptions count as a success, unless they are explicitly ignored by <code>ignoreExceptions</code>.</td>
</tr>
<tr>
<td align="left">ignoreExceptions</td>
<td align="left">empty</td>
<td align="left">A list of exceptions that are ignored and neither count as a failure nor success. Any exception matching or inheriting from one of the list will not count as a failure nor success, even if the exceptions is part of <code>recordExceptions</code>.</td>
</tr>
<tr>
<td align="left">recordFailurePredicate</td>
<td align="left">throwable -&gt; true  By default all exceptions are recored as failures.</td>
<td align="left">A custom Predicate which evaluates if an exception should be recorded as a failure. The Predicate must return true if the exception should count as a failure. The Predicate must return false, if the exception should count as a success, unless the exception is explicitly ignored by <code>ignoreExceptions</code>.</td>
</tr>
<tr>
<td align="left">ignoreExceptionPredicate</td>
<td align="left">throwable -&gt; false  By default no exception is ignored.</td>
<td align="left">A custom Predicate which evaluates if an exception should be ignored and neither count as a failure nor success. The Predicate must return true if the exception should be ignored. The Predicate must return false, if the exception should count as a failure.</td>
</tr>
</tbody></table>
<h2 id="三、Bulkhead"><a href="#三、Bulkhead" class="headerlink" title="三、Bulkhead"></a>三、Bulkhead</h2><p>Resilience4j 提供了信号量隔离和线程池隔离，两种资源隔离方式。</p>
<h3 id="信号量隔离配置"><a href="#信号量隔离配置" class="headerlink" title="信号量隔离配置"></a>信号量隔离配置</h3><table>
<thead>
<tr>
<th align="left">Config property</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">maxConcurrentCalls</td>
<td align="left">25</td>
<td align="left">最大并行数量</td>
</tr>
<tr>
<td align="left">maxWaitDuration</td>
<td align="left">0</td>
<td align="left">当达到最大并行数量后，线程最大等待时间</td>
</tr>
</tbody></table>
<h3 id="线程池隔离配置"><a href="#线程池隔离配置" class="headerlink" title="线程池隔离配置"></a>线程池隔离配置</h3><table>
<thead>
<tr>
<th align="left">Config property</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">maxThreadPoolSize</td>
<td align="left">Runtime.getRuntime() .availableProcessors()</td>
<td align="left">线程池最大线程数</td>
</tr>
<tr>
<td align="left">coreThreadPoolSize</td>
<td align="left">Runtime.getRuntime() .availableProcessors() - 1</td>
<td align="left">核心线程数</td>
</tr>
<tr>
<td align="left">queueCapacity</td>
<td align="left">100</td>
<td align="left">阻塞队列容量</td>
</tr>
<tr>
<td align="left">keepAliveDuration</td>
<td align="left">20 [ms]</td>
<td align="left">线程最大空闲时间</td>
</tr>
</tbody></table>
<h2 id="四、RateLimiter"><a href="#四、RateLimiter" class="headerlink" title="四、RateLimiter"></a>四、RateLimiter</h2><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><table>
<thead>
<tr>
<th align="left">Config property</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">timeoutDuration</td>
<td align="left">5 [s]</td>
<td align="left">线程等待许可的时间</td>
</tr>
<tr>
<td align="left">limitRefreshPeriod</td>
<td align="left">500 [ns]</td>
<td align="left">许可刷新的时间周期。在每个周期之后，速率限制器将其权限计数设置为 limitForPeriod 值</td>
</tr>
<tr>
<td align="left">limitForPeriod</td>
<td align="left">50</td>
<td align="left">每个周期内可用的许可数量</td>
</tr>
</tbody></table>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/posts/3153/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Dubbo3</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/posts/38559/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Sentinel</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">JD</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BE%9D%E8%B5%96"><span class="nav-text">一、依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81CircuitBreaker"><span class="nav-text">二、CircuitBreaker</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B1%E8%B4%A5%E7%8E%87%E5%92%8C%E6%85%A2%E8%B0%83%E7%94%A8%E7%8E%87%E9%98%88%E5%80%BC"><span class="nav-text">失败率和慢调用率阈值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81Bulkhead"><span class="nav-text">三、Bulkhead</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E5%8F%B7%E9%87%8F%E9%9A%94%E7%A6%BB%E9%85%8D%E7%BD%AE"><span class="nav-text">信号量隔离配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E9%9A%94%E7%A6%BB%E9%85%8D%E7%BD%AE"><span class="nav-text">线程池隔离配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81RateLimiter"><span class="nav-text">四、RateLimiter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="nav-text">配置</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
